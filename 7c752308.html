<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/400x400logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.diandian100.cn",root:"/",scheme:"Gemini",version:"8.0.0",exturl:!0,sidebar:{position:"left",display:"always",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"},path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="通常我们本地开发环境使用运行python脚本用的是wsgi，pycharm更是跟我们内置好了；而生产环境下我们所需要的环境通常是：nginx+uwsgi+virturlenvwrapper，本文简单说下此环境下的配置。"><meta property="og:type" content="article"><meta property="og:title" content="uwsgi配置发布web服务器"><meta property="og:url" content="https://www.diandian100.cn/7c752308.html"><meta property="og:site_name" content="点点开发技术分享"><meta property="og:description" content="通常我们本地开发环境使用运行python脚本用的是wsgi，pycharm更是跟我们内置好了；而生产环境下我们所需要的环境通常是：nginx+uwsgi+virturlenvwrapper，本文简单说下此环境下的配置。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820091404.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820092727.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820095538.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820095716.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120720.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120838.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120720.png"><meta property="og:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120838.png"><meta property="article:published_time" content="2019-08-19T09:26:29.000Z"><meta property="article:modified_time" content="2020-09-04T01:00:24.000Z"><meta property="article:author" content="托小尼"><meta property="article:tag" content="nginx"><meta property="article:tag" content="uwsgi配置"><meta property="article:tag" content="uwsgi"><meta property="article:tag" content="django上线"><meta property="article:tag" content="virtualenvwrapper"><meta property="article:tag" content="virtualenv"><meta property="article:tag" content="supervisor"><meta property="article:tag" content="服务器配置"><meta property="article:tag" content="web服务器"><meta property="article:tag" content="python服务器"><meta property="article:tag" content="python上线"><meta property="article:tag" content="收集静态文件"><meta property="article:tag" content="uwsgi负载均衡池"><meta property="article:tag" content="supervisord"><meta property="article:tag" content="supervisorctl"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820091404.png"><link rel="canonical" href="https://www.diandian100.cn/7c752308.html"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>uwsgi配置发布web服务器 | 点点开发技术分享</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3b57832214417f66931e694d19fd60b9";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">点点开发技术分享</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">记录个人日常开发笔记与技巧</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-development"><a href="/categories/rd/" rel="section"><i class="fa fa-code fa-fw"></i>开发</a></li><li class="menu-item menu-item-frontend"><a href="/categories/fe/" rel="section"><i class="fab fa-html5 fa-fw"></i>前端</a></li><li class="menu-item menu-item-database"><a href="/categories/db/" rel="section"><i class="fa fa-database fa-fw"></i>数据库</a></li><li class="menu-item menu-item-os"><a href="/categories/os/" rel="section"><i class="fab fa-linux fa-fw"></i>系统</a></li><li class="menu-item menu-item-other"><a href="/categories/other/" rel="section"><i class="far fa-paper-plane fa-fw"></i>其他</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx"><span class="nav-number">1.1.</span> <span class="nav-text">Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#virtualenvwraper"><span class="nav-number">1.2.</span> <span class="nav-text">virtualenvwraper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python3"><span class="nav-number">1.3.</span> <span class="nav-text">python3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uswgi"><span class="nav-number">1.4.</span> <span class="nav-text">uswgi</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uwsgi%E6%B5%8B%E8%AF%95%E5%8D%95%E6%96%87%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">uwsgi测试单文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAtest-py"><span class="nav-number">2.0.0.1.</span> <span class="nav-text">创建test.py</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E8%AF%A5%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="nav-number">2.0.0.2.</span> <span class="nav-text">运行该文件：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE"><span class="nav-number">2.0.0.3.</span> <span class="nav-text">浏览器访问</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#uwsgi%E6%B5%8B%E8%AF%95django%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.</span> <span class="nav-text">uwsgi测试django程序</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%87%86%E5%A4%87"><span class="nav-number">3.0.0.1.</span> <span class="nav-text">代码准备</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#mysite-urls-py"><span class="nav-number">3.0.0.1.1.</span> <span class="nav-text">mysite&#x2F;urls.py</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#blog-views-py"><span class="nav-number">3.0.0.1.2.</span> <span class="nav-text">blog&#x2F;views.py</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#templates-play-html"><span class="nav-number">3.0.0.1.3.</span> <span class="nav-text">templates&#x2F;play.html</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#static-css-css"><span class="nav-number">3.0.0.1.4.</span> <span class="nav-text">static&#x2F;css.css</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.0.0.2.</span> <span class="nav-text">运行程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.0.0.3.</span> <span class="nav-text">访问程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#socket%E6%B5%8B%E8%AF%95django"><span class="nav-number">4.</span> <span class="nav-text">socket测试django</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEnginx"><span class="nav-number">4.0.0.1.</span> <span class="nav-text">配置nginx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#etc-nginx-nginx-conf"><span class="nav-number">4.0.0.2.</span> <span class="nav-text">etc&#x2F;nginx&#x2F;nginx.conf</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0windows%E4%BF%AE%E6%94%B9hosts"><span class="nav-number">4.0.0.2.1.</span> <span class="nav-text">本地windows修改hosts</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F-1"><span class="nav-number">4.0.0.3.</span> <span class="nav-text">运行程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E7%A8%8B%E5%BA%8F-1"><span class="nav-number">4.0.0.4.</span> <span class="nav-text">访问程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uwsgi%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95django%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.</span> <span class="nav-text">uwsgi使用配置文件测试django程序</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uwsgi%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">5.0.0.1.</span> <span class="nav-text">uwsgi配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEnginx-1"><span class="nav-number">5.0.0.2.</span> <span class="nav-text">配置nginx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F-2"><span class="nav-number">5.0.0.3.</span> <span class="nav-text">运行程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E7%A8%8B%E5%BA%8F-2"><span class="nav-number">5.0.0.4.</span> <span class="nav-text">访问程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6404"><span class="nav-number">5.0.0.5.</span> <span class="nav-text">解决静态文件404</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#mysite-settings-py"><span class="nav-number">5.0.0.5.1.</span> <span class="nav-text">mysite&#x2F;settings.py</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#nginx-conf"><span class="nav-number">5.0.0.5.2.</span> <span class="nav-text">nginx.conf</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%94%B6%E9%9B%86django%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-number">5.0.0.5.3.</span> <span class="nav-text">收集django静态资源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%86%8D%E6%AC%A1%E8%AE%BF%E9%97%AE%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.0.0.6.</span> <span class="nav-text">再次访问程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uwsgi%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">5.1.</span> <span class="nav-text">uwsgi常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#supervisor"><span class="nav-number">6.</span> <span class="nav-text">supervisor</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85supervisor"><span class="nav-number">6.1.</span> <span class="nav-text">安装supervisor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90supervisor%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.</span> <span class="nav-text">生成supervisor配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">6.3.</span> <span class="nav-text">写入配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8supervisor"><span class="nav-number">6.4.</span> <span class="nav-text">启动supervisor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#supervisor%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">6.4.1.</span> <span class="nav-text">supervisor其他命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95"><span class="nav-number">6.5.</span> <span class="nav-text">访问测试</span></a></li></ol></li></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="托小尼" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">托小尼</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">176</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">1033</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cDovL3dwYS5xcS5jb20vbXNncmQ/dj0zJnVpbj02NDY1NDc5ODkmc2l0ZT1xcSZtZW51PXllcw==" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;646547989&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="fab fa-qq fa-fw"></i>QQ</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOnRvbnl5dUB2aXAucXEuY29t" title="E-Mail → mailto:tonyyu@vip.qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span></span></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Rvbnl1MjAxOQ==" title="关注我" aria-label="关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.diandian100.cn/7c752308.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="托小尼"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="点点开发技术分享"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">uwsgi配置发布web服务器</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-19 17:26:29" itemprop="dateCreated datePublished" datetime="2019-08-19T17:26:29+08:00">2019-08-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-04 09:00:24" itemprop="dateModified" datetime="2020-09-04T09:00:24+08:00">2020-09-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/os/" itemprop="url" rel="index"><span itemprop="name">os</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/os/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/os/linux/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan：</span> <a title="changyan" href="/7c752308.html#SOHUCS" itemprop="discussionUrl"><span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="7c752308.html" itemprop="commentCount"></span></a></span></div><div class="post-meta"><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>22k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>20 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>通常我们本地开发环境使用运行python脚本用的是<code>wsgi</code>，<code>pycharm</code>更是跟我们内置好了；而生产环境下我们所需要的环境通常是：<code>nginx+uwsgi+virturlenvwrapper</code>，本文简单说下此环境下的配置。</p><a id="more"></a><p><code>WSGI</code>是<code>Web</code>服务器网关接口。它是一个规范，描述了<code>Web</code>服务器如何与Web应用程序通信，以及<code>Web</code>应用程序如何链接在一起以处理一个请求，（接收请求，处理请求，响应请求）</p><p><code>Django</code>部署</p><p><code>Django</code>的主要部署平台是 <code>WSGI</code>，这是用于<code>Web</code>服务器和应用程序的<code>Python</code>标准。</p><p><code>Django</code>的 <code>startproject</code>管理命令设置一个简单的默认<code>WSGI</code>配置，可以根据需要为您的项目进行调整，并指示任何符合<code>WSGI</code>的应用程序服务器使用。</p><p><code>application</code><br>使用<code>WSGI</code>部署的关键概念是应用程序服务器用于与代码通信的 <code>application</code> 可调用。它通常在服务器可访问的<code>Python</code>模块中作为名为 <code>application</code> 的对象提供。</p><p><code>startproject</code> 命令创建包含这样的 <code>application</code> 可调用的文件 <code>&lt;project_name&gt;/wsgi.py</code>. ，它被<code>Django</code>的开发服务器和生产<code>WSGI</code>部署使用。<br><code>WSGI</code>服务器从其配置中获取 <code>application</code> 可调用的路径。 <code>Django</code>的内置服务器，即 <code>runserver</code> 命令，从 <code>WSGI_APPLICATION</code> 设置读取它。</p><p>以下直接示例演示：</p><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a><code>Nginx</code></h3><p>安装参考：<a href="https://www.diandian100.cn/b5f2e1e2.html#%E5%AE%89%E8%A3%85"><code>nginx</code>安装及配置多域名初体验</a></p><h3 id="virtualenvwraper"><a href="#virtualenvwraper" class="headerlink" title="virtualenvwraper"></a><code>virtualenvwraper</code></h3><p>安装参考：<a href="https://www.diandian100.cn/c9c15d88.html#virtualenvwraper%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><code>virtualenvwraper</code>安装与使用</a></p><h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a><code>python3</code></h3><p>安装参考：<a href="https://www.diandian100.cn/cbf7818.html#python3%E5%AE%89%E8%A3%85"><code>python3</code>安装</a></p><h3 id="uswgi"><a href="#uswgi" class="headerlink" title="uswgi"></a><code>uswgi</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入虚拟环境</span></span><br><span class="line">root@Tony-PC:/opt/pywww# workon django2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看python是否是3.0且指向虚拟环境</span></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# python -V</span><br><span class="line">Python 3.6.5</span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# which python</span><br><span class="line">/opt/pyenv/django2/bin/python</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看pip指向</span></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# pip -V</span><br><span class="line">pip 19.2.2 from /opt/pyenv/django2/lib/python3.6/site-packages/pip (python 3.6)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装uswgi</span></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# pip install uwsgi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查uwsgi和uwsgi python版本</span></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# uwsgi --version</span><br><span class="line">2.0.18</span><br><span class="line">(django2) root@Tony-PC:/opt/pywww# uwsgi --python-version</span><br><span class="line">3.6.5</span><br></pre></td></tr></table></figure><h2 id="uwsgi测试单文件"><a href="#uwsgi测试单文件" class="headerlink" title="uwsgi测试单文件"></a><code>uwsgi</code>测试单文件</h2><h5 id="创建test-py"><a href="#创建test-py" class="headerlink" title="创建test.py"></a>创建<code>test.py</code></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span>(<span class="params">env, start_response</span>):</span></span><br><span class="line">    start_response(<span class="string">&#x27;200 ok&#x27;</span>, [(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>)])</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&#x27;hello world&#x27;</span>]</span><br></pre></td></tr></table></figure><h5 id="运行该文件："><a href="#运行该文件：" class="headerlink" title="运行该文件："></a>运行该文件：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> uwsgi --http :8001 --wsgi-file test.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http :8001: 使用http协议，端口8001</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wsgi-file test.py: 加载指定的文件，test.py</span></span><br><span class="line"></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww/mysite# uwsgi --http :8001 --wsgi-file test.py</span><br><span class="line">*** Starting uWSGI 2.0.18 (64bit) on [Mon Aug 19 18:01:50 2019] ***</span><br><span class="line">compiled with version: 7.3.0 on 19 August 2019 06:30:34</span><br><span class="line">os: Linux-4.15.0-29deepin-generic #31 SMP Fri Jul 27 07:12:08 UTC 2018</span><br><span class="line">nodename: Tony-PC</span><br><span class="line">machine: x86_64</span><br><span class="line">clock source: unix</span><br><span class="line">pcre jit disabled</span><br><span class="line">detected number of CPU cores: 8</span><br><span class="line">current working directory: /opt/pywww/mysite</span><br><span class="line">detected binary path: /opt/pyenv/django2/bin/uwsgi</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">*** WARNING: you are running uWSGI without its master process manager ***</span><br><span class="line">your processes number limit is 31152</span><br><span class="line">your memory page size is 4096 bytes</span><br><span class="line">detected max file descriptor number: 1024</span><br><span class="line">lock engine: pthread robust mutexes</span><br><span class="line">thunder lock: disabled (you can enable it with --thunder-lock)</span><br><span class="line">uWSGI http bound on :8000 fd 4</span><br><span class="line">spawned uWSGI http 1 (pid: 14213)</span><br><span class="line">uwsgi socket 0 bound to TCP address 127.0.0.1:42333 (port auto-assigned) fd 3</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">Python version: 3.6.5 (default, May 11 2018, 13:30:17)  [GCC 7.3.0]</span><br><span class="line">*** Python threads support is disabled. You can enable it with --enable-threads ***</span><br><span class="line">Python main interpreter initialized at 0x5629304088e0</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">your server socket listen backlog is limited to 100 connections</span><br><span class="line">your mercy for graceful operations on workers is 60 seconds</span><br><span class="line">mapped 72920 bytes (71 KB) for 1 cores</span><br><span class="line">*** Operational MODE: single process ***</span><br><span class="line">WSGI app 0 (mountpoint=&#x27;&#x27;) ready in 0 seconds on interpreter 0x5629304088e0 pid: 14212 (default app)</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">*** uWSGI is running in multiple interpreter mode ***</span><br><span class="line">spawned uWSGI worker 1 (and the only) (pid: 14212, cores: 1)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="浏览器访问"><a href="#浏览器访问" class="headerlink" title="浏览器访问"></a>浏览器访问</h5><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820091404.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 控制台显示访问信息：</span></span><br><span class="line">[pid: 4864|app: 0|req: 1/1] 10.10.10.238 () &#123;38 vars in 742 bytes&#125; [Tue Aug 20 09:17:23 2019] GET / =&gt; generated 11 bytes in 0 msecs (HTTP/1.1 200</span><br><span class="line">) 1 headers in 44 bytes (1 switches on core 0)</span><br><span class="line">[pid: 4864|app: 0|req: 2/2] 10.10.10.238 () &#123;38 vars in 691 bytes&#125; [Tue Aug 20 09:17:23 2019] GET /favicon.ico =&gt; generated 11 bytes in 0 msecs (H</span><br><span class="line">TTP/1.1 200) 1 headers in 44 bytes (1 switches on core 0)</span><br></pre></td></tr></table></figure><h2 id="uwsgi测试django程序"><a href="#uwsgi测试django程序" class="headerlink" title="uwsgi测试django程序"></a><code>uwsgi</code>测试<code>django</code>程序</h2><h5 id="代码准备"><a href="#代码准备" class="headerlink" title="代码准备"></a>代码准备</h5><h6 id="mysite-urls-py"><a href="#mysite-urls-py" class="headerlink" title="mysite/urls.py"></a><code>mysite/urls.py</code></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> blog <span class="keyword">import</span> views</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;你好,中国&#x27;</span>)</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;hello&#x27;</span>, hello),</span><br><span class="line">    path(<span class="string">&#x27;play&#x27;</span>, views.play)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h6 id="blog-views-py"><a href="#blog-views-py" class="headerlink" title="blog/views.py"></a><code>blog/views.py</code></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;play.html&#x27;</span>)</span><br></pre></td></tr></table></figure><h6 id="templates-play-html"><a href="#templates-play-html" class="headerlink" title="templates/play.html"></a><code>templates/play.html</code></h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf8&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>测试网页test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css.css&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>我们是中国chinese<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h6 id="static-css-css"><a href="#static-css-css" class="headerlink" title="static/css.css"></a><code>static/css.css</code></h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;<span class="attribute">color</span>:green&#125;</span><br></pre></td></tr></table></figure><h5 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> uwsgi --http :8003 --module mysite.wsgi --py-autoreload=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http :8003: 使用http协议，端口8003</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --module mysite.wsgi: 加载指定的wsgi模块</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --py-autoreload=1： 热加载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时修改django代码，uWSGI会自动加载django程序，页面生效</span></span><br><span class="line"></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww/mysite# uwsgi --http :8003 --module mysite.wsgi --py-autoreload=1</span><br><span class="line"></span><br><span class="line">*** Starting uWSGI 2.0.18 (64bit) on [Tue Aug 20 09:33:03 2019] ***</span><br><span class="line">compiled with version: 7.3.0 on 19 August 2019 06:30:34</span><br><span class="line">os: Linux-4.15.0-29deepin-generic #31 SMP Fri Jul 27 07:12:08 UTC 2018</span><br><span class="line">nodename: Tony-PC</span><br><span class="line">machine: x86_64</span><br><span class="line">clock source: unix</span><br><span class="line">pcre jit disabled</span><br><span class="line">detected number of CPU cores: 8</span><br><span class="line">current working directory: /opt/pywww/mysite</span><br><span class="line">detected binary path: /opt/pyenv/django2/bin/uwsgi</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">your processes number limit is 31152</span><br><span class="line">your memory page size is 4096 bytes</span><br><span class="line">detected max file descriptor number: 1024</span><br><span class="line">lock engine: pthread robust mutexes</span><br><span class="line">thunder lock: disabled (you can enable it with --thunder-lock)</span><br><span class="line">uWSGI http bound on :8003 fd 4</span><br><span class="line">uwsgi socket 0 bound to TCP address 127.0.0.1:35147 (port auto-assigned) fd 3</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">Python version: 3.6.5 (default, May 11 2018, 13:30:17)  [GCC 7.3.0]</span><br><span class="line">Python main interpreter initialized at 0x555e54571920</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">python threads support enabled</span><br><span class="line">your server socket listen backlog is limited to 100 connections</span><br><span class="line">your mercy for graceful operations on workers is 60 seconds</span><br><span class="line">mapped 145840 bytes (142 KB) for 1 cores</span><br><span class="line">*** Operational MODE: single process ***</span><br><span class="line">WSGI app 0 (mountpoint=&#x27;&#x27;) ready in 0 seconds on interpreter 0x555e54571920 pid: 5586 (default app)</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">*** uWSGI is running in multiple interpreter mode ***</span><br><span class="line">spawned uWSGI master process (pid: 5586)</span><br><span class="line">spawned uWSGI worker 1 (pid: 5588, cores: 1)</span><br><span class="line">spawned uWSGI http 1 (pid: 5589)</span><br><span class="line">Python auto-reloader enabled</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="访问程序"><a href="#访问程序" class="headerlink" title="访问程序"></a>访问程序</h5><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820092727.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 控制台显示访问信息：</span></span><br><span class="line">[pid: 5588|app: 0|req: 1/1] 10.10.10.238 () &#123;38 vars in 752 bytes&#125; [Tue Aug 20 01:40:32 2019] GET /hello =&gt; generated 13 bytes in 4 msecs (HTTP/1.</span><br><span class="line">1 200) 3 headers in 108 bytes (1 switches on core 0)</span><br></pre></td></tr></table></figure><h2 id="socket测试django"><a href="#socket测试django" class="headerlink" title="socket测试django"></a><code>socket</code>测试<code>django</code></h2><h5 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置<code>nginx</code></h5><h5 id="etc-nginx-nginx-conf"><a href="#etc-nginx-nginx-conf" class="headerlink" title="etc/nginx/nginx.conf"></a><code>etc/nginx/nginx.conf</code></h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span> test.to;</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># nginx自带ngx_http_uwsgi_module模块，起到nginx和uwsgi交互作用</span></span><br><span class="line">        <span class="comment"># include  就是一个“引入的作用”，就是将外部一个文件的参数，导入到当前的nginx.conf中生效</span></span><br><span class="line">		<span class="attribute">include</span> /etc/nginx/uwsgi_params;</span><br><span class="line">        <span class="comment"># 这里是nginx将请求转发给  uwsgi启动的 8002端口</span></span><br><span class="line">		<span class="attribute">uwsgi_pass</span> <span class="number">0.0.0.0:8002</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="本地windows修改hosts"><a href="#本地windows修改hosts" class="headerlink" title="本地windows修改hosts"></a>本地<code>windows</code>修改<code>hosts</code></h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.125 test.to</span><br></pre></td></tr></table></figure><h5 id="运行程序-1"><a href="#运行程序-1" class="headerlink" title="运行程序"></a>运行程序</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> uwsgi --socket :8002 --module mysite.wsgi --py-autoreload=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket :8002: 使用socket，8002</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --module mysite.wsgi: 加载指定的wsgi模块</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --py-autoreload=1： 热加载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时修改django代码，uWSGI会自动加载django程序，页面生效</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket指的是，uwsgi启动一个socket连接，当你使用nginx+uwsgi的时候，使用socket参数</span></span><br><span class="line"></span><br><span class="line">(django2) root@Tony-PC:/opt/pywww/mysite# uwsgi --socket :8002 --module mysite.wsgi --py-autoreload=1</span><br><span class="line"></span><br><span class="line">*** Starting uWSGI 2.0.18 (64bit) on [Tue Aug 20 09:53:32 2019] ***</span><br><span class="line">compiled with version: 7.3.0 on 19 August 2019 06:30:34</span><br><span class="line">os: Linux-4.15.0-29deepin-generic #31 SMP Fri Jul 27 07:12:08 UTC 2018</span><br><span class="line">nodename: Tony-PC</span><br><span class="line">machine: x86_64</span><br><span class="line">clock source: unix</span><br><span class="line">pcre jit disabled</span><br><span class="line">detected number of CPU cores: 8</span><br><span class="line">current working directory: /opt/pywww/mysite</span><br><span class="line">detected binary path: /opt/pyenv/django2/bin/uwsgi</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">your processes number limit is 31152</span><br><span class="line">your memory page size is 4096 bytes</span><br><span class="line">detected max file descriptor number: 1024</span><br><span class="line">lock engine: pthread robust mutexes</span><br><span class="line">thunder lock: disabled (you can enable it with --thunder-lock)</span><br><span class="line">uwsgi socket 0 bound to TCP address :8002 fd 3</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">Python version: 3.6.5 (default, May 11 2018, 13:30:17)  [GCC 7.3.0]</span><br><span class="line">Python main interpreter initialized at 0x55fd342b62f0</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">python threads support enabled</span><br><span class="line">your server socket listen backlog is limited to 100 connections</span><br><span class="line">your mercy for graceful operations on workers is 60 seconds</span><br><span class="line">mapped 145840 bytes (142 KB) for 1 cores</span><br><span class="line">*** Operational MODE: single process ***</span><br><span class="line">WSGI app 0 (mountpoint=&#x27;&#x27;) ready in 0 seconds on interpreter 0x55fd342b62f0 pid: 6695 (default app)</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">*** uWSGI is running in multiple interpreter mode ***</span><br><span class="line">spawned uWSGI master process (pid: 6695)</span><br><span class="line">spawned uWSGI worker 1 (pid: 6697, cores: 1)</span><br><span class="line">Python auto-reloader enabled</span><br></pre></td></tr></table></figure><h5 id="访问程序-1"><a href="#访问程序-1" class="headerlink" title="访问程序"></a>访问程序</h5><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820095538.png"></p><p>可能此时你还没意识到有什么问题，此时我们访问<code>admin</code>试一下</p><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820095716.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 控制台用户访问信息</span></span><br><span class="line">[pid: 6697|app: 0|req: 1/1] 10.10.10.238 () &#123;42 vars in 739 bytes&#125; [Tue Aug 20 01:59:59 2019] GET /play =&gt; generated 202 bytes in 9 msecs (HTTP/1.</span><br><span class="line">1 200) 3 headers in 109 bytes (1 switches on core 0)Not Found: /static/css.css</span><br><span class="line">[pid: 6697|app: 0|req: 2/2] 10.10.10.238 () &#123;40 vars in 628 bytes&#125; [Tue Aug 20 01:59:59 2019] GET /static/css.css =&gt; generated 2183 bytes in 2 mse</span><br><span class="line">cs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br><span class="line">[pid: 6697|app: 0|req: 3/3] 10.10.10.238 () &#123;40 vars in 710 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /admin =&gt; generated 0 bytes in 0 msecs (HTTP/1.1</span><br><span class="line"> 301) 3 headers in 112 bytes (1 switches on core 0)</span><br><span class="line"> [pid: 6697|app: 0|req: 4/4] 10.10.10.238 () &#123;40 vars in 712 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /admin/ =&gt; generated 0 bytes in 6 msecs (HTTP/1.</span><br><span class="line">1 302) 7 headers in 265 bytes (1 switches on core 0)</span><br><span class="line">[pid: 6697|app: 0|req: 5/5] 10.10.10.238 () &#123;40 vars in 749 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /admin/login/?next=/admin/ =&gt; generated 1819 byt</span><br><span class="line">es in 21 msecs (HTTP/1.1 200) 7 headers in 395 bytes (1 switches on core 0)Not Found: /static/admin/css/base.css</span><br><span class="line">[pid: 6697|app: 0|req: 6/6] 10.10.10.238 () &#123;42 vars in 760 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /static/admin/css/base.css =&gt; generated 2216 byt</span><br><span class="line">es in 2 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)Not Found: /static/admin/css/login.css</span><br><span class="line">[pid: 6697|app: 0|req: 7/7] 10.10.10.238 () &#123;42 vars in 762 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /static/admin/css/login.css =&gt; generated 2219 by</span><br><span class="line">tes in 1 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)Not Found: /static/admin/css/responsive.css</span><br><span class="line">[pid: 6697|app: 0|req: 8/8] 10.10.10.238 () &#123;42 vars in 772 bytes&#125; [Tue Aug 20 02:00:43 2019] GET /static/admin/css/responsive.css =&gt; generated 22</span><br><span class="line">34 bytes in 1 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br></pre></td></tr></table></figure><p>可以看到我们加载的静态资源<code>css</code>等都没有正常显示出来，控制台也都显示静态资源404，后面我们来解决这个问题</p><h2 id="uwsgi使用配置文件测试django程序"><a href="#uwsgi使用配置文件测试django程序" class="headerlink" title="uwsgi使用配置文件测试django程序"></a><code>uwsgi</code>使用配置文件测试<code>django</code>程序</h2><p>上面程序运行时每次都要用长命令，这里我们尝试使用配置文件来运行<code>django</code>程序，并解决上面静态资源<code>404</code>的问题。</p><h5 id="uwsgi配置文件"><a href="#uwsgi配置文件" class="headerlink" title="uwsgi配置文件"></a><code>uwsgi</code>配置文件</h5><p><code>uwsgi</code>支持<code>ini</code>、<code>xml</code>等多种配置方式，本文以 <code>ini</code> 为例， 在<code>/opt/pyuwsgi/</code>目录下新建<code>mysite_uwsgi.ini</code>，添加如下配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysite_uwsgi.ini file</span></span><br><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定项目的绝对路径的第一层路径</span></span><br><span class="line"><span class="attr">chdir</span>           = /opt/pywww/mysite</span><br><span class="line"><span class="comment">#  指定项目的 wsgi.py文件！！！！！！！！！！！！</span></span><br><span class="line"><span class="comment">#  写入相对路径即可，这个参数是以  chdir参数为相对路径</span></span><br><span class="line"><span class="comment"># module与wsgi-file填写一个即可，都代表找到wsgi文件，写法不同</span></span><br><span class="line"><span class="attr">module</span>          = mysite.wsgi</span><br><span class="line"><span class="comment">#wsgi文件路径，在项目底下</span></span><br><span class="line"><span class="comment">#wsgi-file		= mysite/wsgi.py</span></span><br><span class="line"><span class="comment"># 写入虚拟环境解释器的 绝对路径！！！！！！</span></span><br><span class="line"><span class="comment"># 可使用cdvirtualenv进入虚拟环境目录，然后使用pwd查看当前目录</span></span><br><span class="line"><span class="attr">home</span>            = /opt/pyenv/django2</span><br><span class="line"><span class="comment"># 允许主线程存在（true）</span></span><br><span class="line"><span class="attr">master</span>          = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 指定uwsgi启动的进程个数(可根据电脑核心数调整)</span></span><br><span class="line"><span class="attr">processes</span>       = <span class="number">4</span></span><br><span class="line"><span class="comment"># 指定uwsgi启动的线程个数</span></span><br><span class="line"><span class="attr">threads</span> 		= <span class="number">2</span></span><br><span class="line"><span class="comment">#socket指的是，uwsgi启动一个socket连接，当你使用nginx+uwsgi的时候，使用socket参数</span></span><br><span class="line"><span class="attr">socket</span>          = <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8002</span></span><br><span class="line"><span class="comment">#不用nginx直接当做web服务器使用</span></span><br><span class="line"><span class="comment">#http=0.0.0.0:9000</span></span><br><span class="line"><span class="comment">#socket权限设置</span></span><br><span class="line"><span class="comment"># chmod-socket    = 664</span></span><br><span class="line"><span class="comment"># 当服务器退出的时候自动清理环境，删除unix socket文件和pid文件</span></span><br><span class="line"><span class="comment"># vacuum          = true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="配置nginx-1"><a href="#配置nginx-1" class="headerlink" title="配置nginx"></a>配置<code>nginx</code></h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义名为uwsgipool的负载均衡池，池中写入uwsgi发布django的socket地址</span></span><br><span class="line"><span class="attribute">upstream</span> uwsgipool &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">0.0.0.0:8005</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span> test.to;</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># nginx自带ngx_http_uwsgi_module模块，起到nginx和uwsgi交互作用</span></span><br><span class="line">        <span class="comment"># include  就是一个“引入的作用”，就是将外部一个文件的参数，导入到当前的nginx.conf中生效</span></span><br><span class="line">		<span class="attribute">include</span> /etc/nginx/uwsgi_params;</span><br><span class="line">        <span class="comment"># 这里是nginx将请求转发给  uwsgi启动的 8002端口</span></span><br><span class="line">		<span class="comment"># uwsgi_pass 0.0.0.0:8005;</span></span><br><span class="line">        <span class="comment"># 转发至名为uwsgipool的负载均衡池</span></span><br><span class="line">        <span class="attribute">uwsgi_pass</span> uwsgipool;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="运行程序-2"><a href="#运行程序-2" class="headerlink" title="运行程序"></a>运行程序</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用mysite_uwsgi.ini的ini配置文件来启动uwsgi</span></span><br><span class="line">(django2) root@Tony-PC:/opt/pyuwsgi# uwsgi --ini mysite_uwsgi.ini </span><br><span class="line"></span><br><span class="line">[uWSGI] getting INI configuration from mysite_uwsgi.ini</span><br><span class="line">*** Starting uWSGI 2.0.18 (64bit) on [Tue Aug 20 11:22:59 2019] ***</span><br><span class="line">compiled with version: 7.3.0 on 19 August 2019 06:30:34</span><br><span class="line">os: Linux-4.15.0-29deepin-generic #31 SMP Fri Jul 27 07:12:08 UTC 2018</span><br><span class="line">nodename: Tony-PC</span><br><span class="line">machine: x86_64</span><br><span class="line">clock source: unix</span><br><span class="line">pcre jit disabled</span><br><span class="line">detected number of CPU cores: 8</span><br><span class="line">current working directory: /opt/pyuwsgi</span><br><span class="line">detected binary path: /opt/pyenv/django2/bin/uwsgi</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">chdir() to /opt/pywww/mysite</span><br><span class="line">your processes number limit is 31152</span><br><span class="line">your memory page size is 4096 bytes</span><br><span class="line">detected max file descriptor number: 1024</span><br><span class="line">lock engine: pthread robust mutexes</span><br><span class="line">thunder lock: disabled (you can enable it with --thunder-lock)</span><br><span class="line">uwsgi socket 0 bound to TCP address 0.0.0.0:8005 fd 3</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">Python version: 3.6.5 (default, May 11 2018, 13:30:17)  [GCC 7.3.0]</span><br><span class="line">Set PythonHome to /opt/pyenv/django2</span><br><span class="line">*** Python threads support is disabled. You can enable it with --enable-threads ***</span><br><span class="line">Python main interpreter initialized at 0x5601391f2b50</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">your server socket listen backlog is limited to 100 connections</span><br><span class="line">your mercy for graceful operations on workers is 60 seconds</span><br><span class="line">mapped 364600 bytes (356 KB) for 4 cores</span><br><span class="line">*** Operational MODE: preforking ***</span><br><span class="line">WSGI app 0 (mountpoint=&#x27;&#x27;) ready in 0 seconds on interpreter 0x5601391f2b50 pid: 9744 (default app)</span><br><span class="line">uWSGI running as root, you can use --uid/--gid/--chroot options</span><br><span class="line">*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** </span><br><span class="line">*** uWSGI is running in multiple interpreter mode ***</span><br><span class="line">spawned uWSGI master process (pid: 9744)</span><br><span class="line">spawned uWSGI worker 1 (pid: 9746, cores: 1)</span><br><span class="line">spawned uWSGI worker 2 (pid: 9747, cores: 1)</span><br><span class="line">spawned uWSGI worker 3 (pid: 9748, cores: 1)</span><br><span class="line">spawned uWSGI worker 4 (pid: 9749, cores: 1)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查看进程，开启的四个进程正常运行，另外有一个主进程，共5个</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@Tony-PC:/opt# ps -ef | grep uwsgi</span><br><span class="line">root      9744  4738  3 11:22 pts/1    00:00:00 uwsgi --ini mysite_uwsgi.ini</span><br><span class="line">root      9746  9744  0 11:22 pts/1    00:00:00 uwsgi --ini mysite_uwsgi.ini</span><br><span class="line">root      9747  9744  0 11:22 pts/1    00:00:00 uwsgi --ini mysite_uwsgi.ini</span><br><span class="line">root      9748  9744  0 11:22 pts/1    00:00:00 uwsgi --ini mysite_uwsgi.ini</span><br><span class="line">root      9749  9744  0 11:22 pts/1    00:00:00 uwsgi --ini mysite_uwsgi.ini</span><br><span class="line">root      9751  4563  0 11:23 pts/0    00:00:00 grep uwsgi</span><br><span class="line">root@Tony-PC:/opt# netstat -tunlp | grep uwsgi</span><br><span class="line">tcp        0      0 0.0.0.0:8005            0.0.0.0:*               LISTEN      9744/uwsgi  </span><br></pre></td></tr></table></figure><h5 id="访问程序-2"><a href="#访问程序-2" class="headerlink" title="访问程序"></a>访问程序</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[pid: 9748|app: 0|req: 1/1] 10.10.10.238 () &#123;44 vars in 869 bytes&#125; [Tue Aug 20 03:23:27 2019] GET /admin/login/?next=/admin/ =&gt; generated 1819 bytes in 36 msecs (HTTP/1.1 200) 7 headers in 395 bytes (1 switches on core 0)</span><br><span class="line">Not Found: /static/admin/css/base.css</span><br><span class="line">[pid: 9748|app: 0|req: 2/2] 10.10.10.238 () &#123;42 vars in 760 bytes&#125; [Tue Aug 20 03:23:27 2019] GET /static/admin/css/base.css =&gt; generated 2216 bytes in 2 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br><span class="line">Not Found: /static/admin/css/login.css</span><br><span class="line">[pid: 9749|app: 0|req: 1/3] 10.10.10.238 () &#123;42 vars in 762 bytes&#125; [Tue Aug 20 03:23:27 2019] GET /static/admin/css/login.css =&gt; generated 2219 bytes in 7 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br><span class="line">Not Found: /static/admin/css/responsive.css</span><br><span class="line">[pid: 9747|app: 0|req: 1/4] 10.10.10.238 () &#123;42 vars in 772 bytes&#125; [Tue Aug 20 03:23:27 2019] GET /static/admin/css/responsive.css =&gt; generated 2234 bytes in 7 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br><span class="line">[pid: 9748|app: 0|req: 3/5] 10.10.10.238 () &#123;44 vars in 821 bytes&#125; [Tue Aug 20 03:23:46 2019] GET /play =&gt; generated 202 bytes in 0 msecs (HTTP/1.1 200) 3 headers in 109 bytes (1 switches on core 0)</span><br><span class="line">Not Found: /static/css.css</span><br><span class="line">[pid: 9748|app: 0|req: 4/6] 10.10.10.238 () &#123;44 vars in 741 bytes&#125; [Tue Aug 20 03:23:46 2019] GET /static/css.css =&gt; generated 2183 bytes in 1 msecs (HTTP/1.1 404) 3 headers in 102 bytes (1 switches on core 0)</span><br></pre></td></tr></table></figure><p>发现静态资源依然是404</p><h5 id="解决静态文件404"><a href="#解决静态文件404" class="headerlink" title="解决静态文件404"></a>解决静态文件404</h5><h6 id="mysite-settings-py"><a href="#mysite-settings-py" class="headerlink" title="mysite/settings.py"></a><code>mysite/settings.py</code></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静态文件目录的绝对地址</span></span><br><span class="line">STATIC_ROOT = <span class="string">&#x27;/opt/pywww/mysite/static&#x27;</span></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">STATICFILES_DIRS=[</span><br><span class="line">        os.path.join(BASE_DIR, <span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h6 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a><code>nginx.conf</code></h6><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义名为uwsgipool的负载均衡池，池中写入uwsgi发布django的socket地址</span></span><br><span class="line"><span class="attribute">upstream</span> uwsgipool &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">0.0.0.0:8005</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span> test.to;</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">		 <span class="comment"># nginx自带ngx_http_uwsgi_module模块，起到nginx和uwsgi交互作用</span></span><br><span class="line">        <span class="comment"># include  就是一个“引入的作用”，就是将外部一个文件的参数，导入到当前的nginx.conf中生效</span></span><br><span class="line">		<span class="attribute">include</span> /etc/nginx/uwsgi_params;</span><br><span class="line">        <span class="comment"># 这里是nginx将请求转发给  uwsgi启动的 8002端口</span></span><br><span class="line">		<span class="comment"># uwsgi_pass 0.0.0.0:8005;</span></span><br><span class="line">        <span class="comment"># 转发至名为uwsgipool的负载均衡池</span></span><br><span class="line">        <span class="attribute">uwsgi_pass</span> uwsgipool;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment"># 配置静态资源目录，与settings.py路径一致</span></span><br><span class="line">	<span class="attribute">location</span> /static &#123;</span><br><span class="line">		<span class="attribute">alias</span> /opt/pywww/mysite/static;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="收集django静态资源"><a href="#收集django静态资源" class="headerlink" title="收集django静态资源"></a>收集<code>django</code>静态资源</h6><p>重启<code>nginx</code>，使用<code>python3 manage.py collectstatic</code>收集静态资源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(django2) root@Tony-PC:/opt/pywww/mysite# python manage.py collectstatic</span><br><span class="line"></span><br><span class="line">You have requested to collect static files at the destination</span><br><span class="line">location as specified in your settings:</span><br><span class="line"></span><br><span class="line">    /opt/pywww/mysite/static</span><br><span class="line"></span><br><span class="line">This will overwrite existing files!</span><br><span class="line">Are you sure you want to do this?</span><br><span class="line"></span><br><span class="line">Type &#x27;yes&#x27; to continue, or &#x27;no&#x27; to cancel: yes</span><br><span class="line"></span><br><span class="line">119 static files copied to &#x27;/opt/pywww/mysite/static&#x27;, 1 unmodified.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>119个文件已拷贝至目标目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">(django2) root@Tony-PC:/opt/pywww/mysite# tree static</span><br><span class="line">static</span><br><span class="line">├── admin</span><br><span class="line">│   ├── css</span><br><span class="line">│   │   ├── autocomplete.css</span><br><span class="line">│   │   ├── base.css</span><br><span class="line">│   │   ├── changelists.css</span><br><span class="line">│   │   ├── dashboard.css</span><br><span class="line">│   │   ├── fonts.css</span><br><span class="line">│   │   ├── forms.css</span><br><span class="line">│   │   ├── login.css</span><br><span class="line">│   │   ├── responsive.css</span><br><span class="line">│   │   ├── responsive_rtl.css</span><br><span class="line">│   │   ├── rtl.css</span><br><span class="line">│   │   ├── vendor</span><br><span class="line">│   │   │   └── select2</span><br><span class="line">│   │   │       ├── LICENSE-SELECT2.md</span><br><span class="line">│   │   │       ├── select2.css</span><br><span class="line">│   │   │       └── select2.min.css</span><br><span class="line">│   │   └── widgets.css</span><br><span class="line">│   ├── fonts</span><br><span class="line">│   │   ├── LICENSE.txt</span><br><span class="line">│   │   ├── README.txt</span><br><span class="line">│   │   ├── Roboto-Bold-webfont.woff</span><br><span class="line">│   │   ├── Roboto-Light-webfont.woff</span><br><span class="line">│   │   └── Roboto-Regular-webfont.woff</span><br><span class="line">│   ├── img</span><br><span class="line">│   │   ├── calendar-icons.svg</span><br><span class="line">│   │   ├── gis</span><br><span class="line">│   │   │   ├── move_vertex_off.svg</span><br><span class="line">│   │   │   └── move_vertex_on.svg</span><br><span class="line">│   │   ├── icon-addlink.svg</span><br><span class="line">│   │   ├── icon-alert.svg</span><br><span class="line">│   │   ├── icon-calendar.svg</span><br><span class="line">│   │   ├── icon-changelink.svg</span><br><span class="line">│   │   ├── icon-clock.svg</span><br><span class="line">│   │   ├── icon-deletelink.svg</span><br><span class="line">│   │   ├── icon-no.svg</span><br><span class="line">│   │   ├── icon-unknown-alt.svg</span><br><span class="line">│   │   ├── icon-unknown.svg</span><br><span class="line">│   │   ├── icon-viewlink.svg</span><br><span class="line">│   │   ├── icon-yes.svg</span><br><span class="line">│   │   ├── inline-delete.svg</span><br><span class="line">│   │   ├── LICENSE</span><br><span class="line">│   │   ├── README.txt</span><br><span class="line">│   │   ├── search.svg</span><br><span class="line">│   │   ├── selector-icons.svg</span><br><span class="line">│   │   ├── sorting-icons.svg</span><br><span class="line">│   │   ├── tooltag-add.svg</span><br><span class="line">│   │   └── tooltag-arrowright.svg</span><br><span class="line">│   └── js</span><br><span class="line">│       ├── actions.js</span><br><span class="line">│       ├── actions.min.js</span><br><span class="line">│       ├── admin</span><br><span class="line">│       │   ├── DateTimeShortcuts.js</span><br><span class="line">│       │   └── RelatedObjectLookups.js</span><br><span class="line">│       ├── autocomplete.js</span><br><span class="line">│       ├── calendar.js</span><br><span class="line">│       ├── cancel.js</span><br><span class="line">│       ├── change_form.js</span><br><span class="line">│       ├── collapse.js</span><br><span class="line">│       ├── collapse.min.js</span><br><span class="line">│       ├── core.js</span><br><span class="line">│       ├── inlines.js</span><br><span class="line">│       ├── inlines.min.js</span><br><span class="line">│       ├── jquery.init.js</span><br><span class="line">│       ├── popup_response.js</span><br><span class="line">│       ├── prepopulate_init.js</span><br><span class="line">│       ├── prepopulate.js</span><br><span class="line">│       ├── prepopulate.min.js</span><br><span class="line">│       ├── SelectBox.js</span><br><span class="line">│       ├── SelectFilter2.js</span><br><span class="line">│       ├── timeparse.js</span><br><span class="line">│       ├── urlify.js</span><br><span class="line">│       └── vendor</span><br><span class="line">│           ├── jquery</span><br><span class="line">│           │   ├── jquery.js</span><br><span class="line">│           │   ├── jquery.min.js</span><br><span class="line">│           │   └── LICENSE.txt</span><br><span class="line">│           ├── select2</span><br><span class="line">│           │   ├── i18n</span><br><span class="line">│           │   │   ├── ar.js</span><br><span class="line">│           │   │   ├── az.js</span><br><span class="line">│           │   │   ├── bg.js</span><br><span class="line">│           │   │   ├── ca.js</span><br><span class="line">│           │   │   ├── cs.js</span><br><span class="line">│           │   │   ├── da.js</span><br><span class="line">│           │   │   ├── de.js</span><br><span class="line">│           │   │   ├── el.js</span><br><span class="line">│           │   │   ├── en.js</span><br><span class="line">│           │   │   ├── es.js</span><br><span class="line">│           │   │   ├── et.js</span><br><span class="line">│           │   │   ├── eu.js</span><br><span class="line">│           │   │   ├── fa.js</span><br><span class="line">│           │   │   ├── fi.js</span><br><span class="line">│           │   │   ├── fr.js</span><br><span class="line">│           │   │   ├── gl.js</span><br><span class="line">│           │   │   ├── he.js</span><br><span class="line">│           │   │   ├── hi.js</span><br><span class="line">│           │   │   ├── hr.js</span><br><span class="line">│           │   │   ├── hu.js</span><br><span class="line">│           │   │   ├── id.js</span><br><span class="line">│           │   │   ├── is.js</span><br><span class="line">│           │   │   ├── it.js</span><br><span class="line">│           │   │   ├── ja.js</span><br><span class="line">│           │   │   ├── km.js</span><br><span class="line">│           │   │   ├── ko.js</span><br><span class="line">│           │   │   ├── lt.js</span><br><span class="line">│           │   │   ├── lv.js</span><br><span class="line">│           │   │   ├── mk.js</span><br><span class="line">│           │   │   ├── ms.js</span><br><span class="line">│           │   │   ├── nb.js</span><br><span class="line">│           │   │   ├── nl.js</span><br><span class="line">│           │   │   ├── pl.js</span><br><span class="line">│           │   │   ├── pt-BR.js</span><br><span class="line">│           │   │   ├── pt.js</span><br><span class="line">│           │   │   ├── ro.js</span><br><span class="line">│           │   │   ├── ru.js</span><br><span class="line">│           │   │   ├── sk.js</span><br><span class="line">│           │   │   ├── sr-Cyrl.js</span><br><span class="line">│           │   │   ├── sr.js</span><br><span class="line">│           │   │   ├── sv.js</span><br><span class="line">│           │   │   ├── th.js</span><br><span class="line">│           │   │   ├── tr.js</span><br><span class="line">│           │   │   ├── uk.js</span><br><span class="line">│           │   │   ├── vi.js</span><br><span class="line">│           │   │   ├── zh-CN.js</span><br><span class="line">│           │   │   └── zh-TW.js</span><br><span class="line">│           │   ├── LICENSE.md</span><br><span class="line">│           │   ├── select2.full.js</span><br><span class="line">│           │   └── select2.full.min.js</span><br><span class="line">│           └── xregexp</span><br><span class="line">│               ├── LICENSE.txt</span><br><span class="line">│               ├── xregexp.js</span><br><span class="line">│               └── xregexp.min.js</span><br><span class="line">└── css.css</span><br><span class="line"></span><br><span class="line">14 directories, 120 files</span><br></pre></td></tr></table></figure><h5 id="再次访问程序"><a href="#再次访问程序" class="headerlink" title="再次访问程序"></a>再次访问程序</h5><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120720.png"></p><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120838.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 资源正常加载</span></span><br><span class="line">[pid: 9747|app: 0|req: 2/8] 10.10.10.238 () &#123;44 vars in 828 bytes&#125; [Tue Aug 20 04:13:08 2019] GET /play =&gt; generated 202 bytes in 5 msecs (HTTP/1.1 200) 3 headers in 109 bytes (1 switches on core 0)</span><br><span class="line">[pid: 9748|app: 0|req: 5/9] 10.10.10.238 () &#123;42 vars in 801 bytes&#125; [Tue Aug 20 04:13:12 2019] GET /admin/ =&gt; generated 0 bytes in 0 msecs (HTTP/1.1 302) 7 headers in 265 bytes (1 switches on core 0)</span><br><span class="line">[pid: 9748|app: 0|req: 6/10] 10.10.10.238 () &#123;42 vars in 838 bytes&#125; [Tue Aug 20 04:13:12 2019] GET /admin/login/?next=/admin/ =&gt; generated 1819 bytes in 7 msecs (HTTP/1.1 200) 7 headers in 395 bytes (1 switches on core 0)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="uwsgi常用命令"><a href="#uwsgi常用命令" class="headerlink" title="uwsgi常用命令"></a><code>uwsgi</code>常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">uwsgi --ini uwsgi.ini             <span class="comment"># 启动</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">uwsgi --reload uwsgi.pid          <span class="comment"># 重启</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">uwsgi --stop uwsgi.pid            <span class="comment"># 关闭</span></span></span><br></pre></td></tr></table></figure><p>更多<code>uwsgi</code>配置参考手册<span class="exturl" data-url="aHR0cHM6Ly91d3NnaS1kb2NzLWNuLnJlYWR0aGVkb2NzLmlvL3poX0NOL2xhdGVzdC9XU0dJcXVpY2tzdGFydC5odG1s">https://uwsgi-docs-cn.readthedocs.io/zh_CN/latest/WSGIquickstart.html<i class="fa fa-external-link-alt"></i></span></p><h2 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a><code>supervisor</code></h2><p><code>supervisor</code> 是基于 <code>python</code> 的任务管理工具，用来自动运行各种后台任务，当然你也能直接利用 <code>nohup</code> 命令使任务自动后台运行，但如果要重启任务，每次都自己手动 <code>kill</code> 掉任务进程，这样很繁琐，而且一旦程序错误导致进程退出的话，系统也无法自动重载任务。</p><h3 id="安装supervisor"><a href="#安装supervisor" class="headerlink" title="安装supervisor"></a>安装<code>supervisor</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Tony-PC:/opt/pywww/mysite# pip3 install supervisor</span><br></pre></td></tr></table></figure><h3 id="生成supervisor配置文件"><a href="#生成supervisor配置文件" class="headerlink" title="生成supervisor配置文件"></a>生成<code>supervisor</code>配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Tony-PC:/opt/pysupervisor# echo_supervisord_conf &gt; /opt/pysupervisor/supervisord.conf</span><br></pre></td></tr></table></figure><p><code>/opt/pysupervisor/supervisord.conf</code>参数说明</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">supervisord.conf配置文件参数解释</span><br><span class="line">[program:xx]是被管理的进程配置参数，xx是进程的名称</span><br><span class="line"><span class="section">[program:xx]</span></span><br><span class="line"><span class="attr">command</span>=/opt/apache-tomcat-<span class="number">8.0</span>.<span class="number">35</span>/bin/catalina.sh run  <span class="comment">; 程序启动命令</span></span><br><span class="line"><span class="attr">autostart</span>=<span class="literal">true</span>       <span class="comment">; 在supervisord启动的时候也自动启动</span></span><br><span class="line"><span class="attr">startsecs</span>=<span class="number">10</span>         <span class="comment">; 启动10秒后没有异常退出，就表示进程正常启动了，默认为1秒</span></span><br><span class="line"><span class="attr">autorestart</span>=<span class="literal">true</span>     <span class="comment">; 程序退出后自动重启,可选值：[unexpected,true,false]，默认为unexpected，表示进程意外杀死后才重启</span></span><br><span class="line"><span class="attr">startretries</span>=<span class="number">3</span>       <span class="comment">; 启动失败自动重试次数，默认是3</span></span><br><span class="line"><span class="attr">user</span>=tomcat          <span class="comment">; 用哪个用户启动进程，默认是root</span></span><br><span class="line"><span class="attr">priority</span>=<span class="number">999</span>         <span class="comment">; 进程启动优先级，默认999，值小的优先启动</span></span><br><span class="line"><span class="attr">redirect_stderr</span>=<span class="literal">true</span> <span class="comment">; 把stderr重定向到stdout，默认false</span></span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span>=<span class="number">20</span>MB  <span class="comment">; stdout 日志文件大小，默认50MB</span></span><br><span class="line"><span class="attr">stdout_logfile_backups</span> = <span class="number">20</span>   <span class="comment">; stdout 日志文件备份数，默认是10</span></span><br><span class="line"><span class="comment">; stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）</span></span><br><span class="line"><span class="attr">stdout_logfile</span>=/opt/apache-tomcat-<span class="number">8.0</span>.<span class="number">35</span>/logs/catalina.out</span><br><span class="line"><span class="attr">stopasgroup</span>=<span class="literal">false</span>     <span class="comment">;默认为false,进程被杀死时，是否向这个进程组发送stop信号，包括子进程</span></span><br><span class="line"><span class="attr">killasgroup</span>=<span class="literal">false</span>     <span class="comment">;默认为false，向进程组发送kill信号，包括子进程</span></span><br></pre></td></tr></table></figure><h3 id="写入配置"><a href="#写入配置" class="headerlink" title="写入配置"></a>写入配置</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:mysupervisord]</span></span><br><span class="line"><span class="attr">command</span> = /opt/pyenv/django2/bin/uwsgi --ini /opt/pyuwsgi/mysite_uwsgi.ini</span><br></pre></td></tr></table></figure><h3 id="启动supervisor"><a href="#启动supervisor" class="headerlink" title="启动supervisor"></a>启动<code>supervisor</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c /etc/supervisord.conf #启动supervisor</span><br><span class="line"></span><br><span class="line">supervisorctl -c /etxc/supervisord.conf restart my  #重启my项目</span><br><span class="line">supervisorctl -c /etc/supervisord.conf [start|stop|restart] [program-name|all]</span><br></pre></td></tr></table></figure><h4 id="supervisor其他命令"><a href="#supervisor其他命令" class="headerlink" title="supervisor其他命令"></a><code>supervisor</code>其他命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl</span><br><span class="line">进入更新新的配置到supervisord交互命令行</span><br><span class="line"></span><br><span class="line">二、更新新的配置到supervisord    </span><br><span class="line"></span><br><span class="line">supervisorctl update</span><br><span class="line">三、重新启动配置中的所有程序</span><br><span class="line"></span><br><span class="line">supervisorctl reload</span><br><span class="line">四、启动某个进程(program_name=你配置中写的程序名称)</span><br><span class="line"></span><br><span class="line">supervisorctl start program_name</span><br><span class="line">五、查看正在守候的进程</span><br><span class="line"></span><br><span class="line">supervisorctl</span><br><span class="line">六、停止某一进程 (program_name=你配置中写的程序名称)</span><br><span class="line"></span><br><span class="line">pervisorctl stop program_name</span><br><span class="line">七、重启某一进程 (program_name=你配置中写的程序名称)</span><br><span class="line"></span><br><span class="line">supervisorctl restart program_name</span><br><span class="line">八、停止全部进程</span><br><span class="line"></span><br><span class="line">supervisorctl stop all</span><br><span class="line">注意：显示用stop停止掉的进程，用reload或者update都不会自动重启。</span><br></pre></td></tr></table></figure><h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120720.png"></p><p><img data-src="https://raw.githubusercontent.com/tonyu2019/PicGo/master/20190820120838.png"></p><p>正常</p></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/c659d82f.html" rel="bookmark">linux搭建LNMP环境通用</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/4d5a2676.html" rel="bookmark">阿里云ssl证书nginx和apache下如何配置</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/b5f2e1e2.html" rel="bookmark">nginx安装及配置多域名初体验</a></div></li></ul><footer class="post-footer"><div class="reward-container"><div>打赏个鸡腿</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="托小尼 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="托小尼 支付宝"> <span>支付宝</span></div></div></div><div class="post-tags"><a href="/tags/nginx/" rel="tag"><i class="fa fa-tag"></i> nginx</a> <a href="/tags/uwsgi%E9%85%8D%E7%BD%AE/" rel="tag"><i class="fa fa-tag"></i> uwsgi配置</a> <a href="/tags/uwsgi/" rel="tag"><i class="fa fa-tag"></i> uwsgi</a> <a href="/tags/django%E4%B8%8A%E7%BA%BF/" rel="tag"><i class="fa fa-tag"></i> django上线</a> <a href="/tags/virtualenvwrapper/" rel="tag"><i class="fa fa-tag"></i> virtualenvwrapper</a> <a href="/tags/virtualenv/" rel="tag"><i class="fa fa-tag"></i> virtualenv</a> <a href="/tags/supervisor/" rel="tag"><i class="fa fa-tag"></i> supervisor</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/" rel="tag"><i class="fa fa-tag"></i> 服务器配置</a> <a href="/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> web服务器</a> <a href="/tags/python%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> python服务器</a> <a href="/tags/python%E4%B8%8A%E7%BA%BF/" rel="tag"><i class="fa fa-tag"></i> python上线</a> <a href="/tags/%E6%94%B6%E9%9B%86%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6/" rel="tag"><i class="fa fa-tag"></i> 收集静态文件</a> <a href="/tags/uwsgi%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%B1%A0/" rel="tag"><i class="fa fa-tag"></i> uwsgi负载均衡池</a> <a href="/tags/supervisord/" rel="tag"><i class="fa fa-tag"></i> supervisord</a> <a href="/tags/supervisorctl/" rel="tag"><i class="fa fa-tag"></i> supervisorctl</a></div><div class="post-nav"><div class="post-nav-item"><a href="/1e121151.html" rel="prev" title="nginx负载均衡"><i class="fa fa-chevron-left"></i> nginx负载均衡</a></div><div class="post-nav-item"><a href="/807b7587.html" rel="next" title="Access-Control-Allow-Origin跨域问题">Access-Control-Allow-Origin跨域问题 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments"><div id="SOHUCS"></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">豫ICP备17028303号-1 </span><img src="http://www.beian.gov.cn/portal/download" style="display:inline-block"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5nb3YuY24vcG9ydGFsL3JlZ2lzdGVyU3lzdGVtSW5mbz9yZWNvcmRjb2RlPTE3MDI4MzAz">豫公网安备 41102402000095号</span></div><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Tony Yu</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">1.1m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">16:05</span></span></div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1.15.0/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments('#SOHUCS', () => {
    NexT.utils.getScript('https://changyan.sohu.com/upload/changyan.js', () => {
      window.changyan.api.config({
        appid: 'cyu11Umgd',
        conf : '0f296687f6a61e82028fd7c6ddf32ab9'
      });
    });
  });</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script></body></html>