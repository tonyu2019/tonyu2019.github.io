<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/400x400logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.diandian100.cn",root:"/",scheme:"Gemini",version:"8.0.0",exturl:!0,sidebar:{position:"left",display:"always",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"},path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="之前用php的时候也爬取过别人网站的数据，那时候采集数据，感觉自从python火起来之后就变为爬虫了，甚至让人觉得一说到爬虫代指的就是python了，不过想想来看使用python制作爬虫比当年使用php采集简直容易简单的太多了，php那时候只能自个写正则进行繁琐的匹配，python不光可以使用正则，第三方库使用xpath和BeautifulSoup进行目标解析让我不用正则就能轻松爬取到想要的数据，"><meta property="og:type" content="article"><meta property="og:title" content="Python爬虫系列之requests模块"><meta property="og:url" content="https://www.diandian100.cn/60bd9920.html"><meta property="og:site_name" content="点点开发技术分享"><meta property="og:description" content="之前用php的时候也爬取过别人网站的数据，那时候采集数据，感觉自从python火起来之后就变为爬虫了，甚至让人觉得一说到爬虫代指的就是python了，不过想想来看使用python制作爬虫比当年使用php采集简直容易简单的太多了，php那时候只能自个写正则进行繁琐的匹配，python不光可以使用正则，第三方库使用xpath和BeautifulSoup进行目标解析让我不用正则就能轻松爬取到想要的数据，"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-10-31T01:30:29.000Z"><meta property="article:modified_time" content="2020-09-04T01:00:24.000Z"><meta property="article:author" content="托小尼"><meta property="article:tag" content="python爬虫"><meta property="article:tag" content="爬虫"><meta property="article:tag" content="requests爬虫"><meta property="article:tag" content="requests模块"><meta property="article:tag" content="python模拟访问网址"><meta property="article:tag" content="python模拟登录"><meta property="article:tag" content="requests.get"><meta property="article:tag" content="requests.post"><meta property="article:tag" content="requests代理"><meta property="article:tag" content="requests代理ip"><meta property="article:tag" content="requests伪装代理"><meta property="article:tag" content="requests伪装ip"><meta property="article:tag" content="爬虫代理ip"><meta property="article:tag" content="python代理ip"><meta property="article:tag" content="爬取豆瓣"><meta property="article:tag" content="模拟会话"><meta property="article:tag" content="保持会话"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.diandian100.cn/60bd9920.html"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Python爬虫系列之requests模块 | 点点开发技术分享</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3b57832214417f66931e694d19fd60b9";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">点点开发技术分享</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">记录个人日常开发笔记与技巧</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-development"><a href="/categories/rd/" rel="section"><i class="fa fa-code fa-fw"></i>开发</a></li><li class="menu-item menu-item-frontend"><a href="/categories/fe/" rel="section"><i class="fab fa-html5 fa-fw"></i>前端</a></li><li class="menu-item menu-item-database"><a href="/categories/db/" rel="section"><i class="fa fa-database fa-fw"></i>数据库</a></li><li class="menu-item menu-item-os"><a href="/categories/os/" rel="section"><i class="fab fa-linux fa-fw"></i>系统</a></li><li class="menu-item menu-item-other"><a href="/categories/other/" rel="section"><i class="far fa-paper-plane fa-fw"></i>其他</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Requests%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">Requests简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#requests%E4%B8%8Eurllib%E6%A8%A1%E5%9D%97%E5%AF%B9%E6%AF%94"><span class="nav-number">1.1.</span> <span class="nav-text">requests与urllib模块对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">主要方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#requests-get"><span class="nav-number">1.3.1.</span> <span class="nav-text">requests.get()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#url"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">url</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#params"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">params</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#kwargs"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">**kwargs</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">响应数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BE%E4%BE%8B"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">举例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#request-head"><span class="nav-number">1.3.2.</span> <span class="nav-text">request.head()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests-post"><span class="nav-number">1.3.3.</span> <span class="nav-text">requests.post()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#post%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">post一个字典</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#post%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">post字符串</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E7%BC%96%E7%A0%81%E4%B8%BAdata"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">自动编码为data</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#post%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">post一个文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#requests%E4%BB%A3%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">requests代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%9A%E8%AF%9D%E7%BB%B4%E6%8C%81"><span class="nav-number">3.</span> <span class="nav-text">会话维持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E4%BA%BA%E4%BA%BA%E7%BD%91"><span class="nav-number">3.1.</span> <span class="nav-text">登录人人网</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E9%AA%8C%E8%AF%81%E7%A0%81%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.1.</span> <span class="nav-text">识别验证码文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.2.</span> <span class="nav-text">主代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%8F%A4%E8%AF%97%E6%96%87%E7%BD%91"><span class="nav-number">3.2.</span> <span class="nav-text">登录古诗文网</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">4.</span> <span class="nav-text">多线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%99%E9%87%8C"><span class="nav-number">5.</span> <span class="nav-text">这里</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E5%8F%96%E6%90%9C%E7%8B%97"><span class="nav-number">5.1.</span> <span class="nav-text">爬取搜狗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="nav-number">5.2.</span> <span class="nav-text">豆瓣电影排行榜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B1%86%E7%93%A3%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE"><span class="nav-number">5.3.</span> <span class="nav-text">豆瓣登录数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8D%AF%E7%9B%91%E5%B1%80"><span class="nav-number">5.4.</span> <span class="nav-text">药监局</span></a></li></ol></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="托小尼" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">托小尼</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">181</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">1074</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cDovL3dwYS5xcS5jb20vbXNncmQ/dj0zJnVpbj02NDY1NDc5ODkmc2l0ZT1xcSZtZW51PXllcw==" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;646547989&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="fab fa-qq fa-fw"></i>QQ</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOnRvbnl5dUB2aXAucXEuY29t" title="E-Mail → mailto:tonyyu@vip.qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span></span></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Rvbnl1MjAxOQ==" title="关注我" aria-label="关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.diandian100.cn/60bd9920.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="托小尼"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="点点开发技术分享"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Python爬虫系列之requests模块</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-31 09:30:29" itemprop="dateCreated datePublished" datetime="2019-10-31T09:30:29+08:00">2019-10-31</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-04 09:00:24" itemprop="dateModified" datetime="2020-09-04T09:00:24+08:00">2020-09-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/rd/" itemprop="url" rel="index"><span itemprop="name">rd</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/rd/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan：</span> <a title="changyan" href="/60bd9920.html#SOHUCS" itemprop="discussionUrl"><span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="60bd9920.html" itemprop="commentCount"></span></a></span></div><div class="post-meta"><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>22k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>20 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>之前用<code>php</code>的时候也爬取过别人网站的数据，那时候采集数据，感觉自从<code>python</code>火起来之后就变为爬虫了，甚至让人觉得一说到爬虫代指的就是<code>python</code>了，不过想想来看使用<code>python</code>制作爬虫比当年使用<code>php</code>采集简直容易简单的太多了，<code>php</code>那时候只能自个写正则进行繁琐的匹配，<code>python</code>不光可以使用正则，第三方库使用<code>xpath</code>和<code>BeautifulSoup</code>进行目标解析让我不用正则就能轻松爬取到想要的数据，一个字“太爽了”！！！</p><a id="more"></a><p><code>Requests</code> 唯一的一个<strong>非转基因</strong>的 <code>Python HTTP</code> 库，人类可以安全享用。</p><p><strong>警告</strong>：非专业使用其他 <code>HTTP</code> 库会导致危险的副作用，包括：安全缺陷症、冗余代码症、重新发明轮子症、啃文档症、抑郁、头疼、甚至死亡。</p><h2 id="Requests简介"><a href="#Requests简介" class="headerlink" title="Requests简介"></a>Requests简介</h2><p>requests模块是python中原生的基于网络请求的模块，其主要作用是用来模拟浏览器发起请求。功能强大，用法简洁高效。在爬虫领域中占据着半壁江山的地位。</p><h3 id="requests与urllib模块对比"><a href="#requests与urllib模块对比" class="headerlink" title="requests与urllib模块对比"></a>requests与urllib模块对比</h3><table><thead><tr><th><code>urllib</code></th><th><code>requests</code></th></tr></thead><tbody><tr><td>手动处理<code>url</code>编码</td><td>自动处理<code>url</code>编码</td></tr><tr><td>手动处理post请求参数</td><td>自动处理post请求参数</td></tr><tr><td>处理cookie和代理操作繁琐</td><td>简化cookie和代理操作</td></tr></tbody></table><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure><h3 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h3><table><thead><tr><th><strong>方法</strong></th><th>解释</th></tr></thead><tbody><tr><td><code>requests.request()</code></td><td>构造一个请求，支持以下各种方法</td></tr><tr><td><code>requests.get()</code></td><td>获取<code>html</code>的主要方法</td></tr><tr><td><code>requests.head()</code></td><td>获取<code>html</code>头部信息的主要方法</td></tr><tr><td><code>requests.post()</code></td><td>向<code>html</code>网页提交<code>post</code>请求的方法</td></tr><tr><td><code>requests.put()</code></td><td>向<code>html</code>网页提交<code>put</code>请求的方法</td></tr><tr><td><code>requests.patch()</code></td><td>向<code>html</code>提交局部修改的请求</td></tr><tr><td><code>requests.delete()</code></td><td>向<code>html</code>提交删除请求</td></tr></tbody></table><h4 id="requests-get"><a href="#requests-get" class="headerlink" title="requests.get()"></a><code>requests.get()</code></h4><p>语法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r=requests.get(url,params,**kwargs)</span><br><span class="line"><span class="comment"># url: 需要爬取的网站地址。</span></span><br><span class="line"><span class="comment"># params: 翻译过来就是参数， url中的额外参数，字典或者字节流格式，可选。</span></span><br><span class="line"><span class="comment"># **kwargs : 12个控制访问的参数</span></span><br></pre></td></tr></table></figure><h5 id="url"><a href="#url" class="headerlink" title="url"></a><code>url</code></h5><p>要请求的目标地址</p><h5 id="params"><a href="#params" class="headerlink" title="params"></a><code>params</code></h5><p>字典或字节序列， 作为参数增加到<code>url</code>中,使用这个参数可以把一些键值对以<code>?key1=value1&amp;key2=value2</code>的模式增加到<code>url</code>中</p><h5 id="kwargs"><a href="#kwargs" class="headerlink" title="**kwargs"></a><code>**kwargs</code></h5><p>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kv = &#123;<span class="string">&#x27;key1&#x27;</span>:<span class="string">&#x27; values&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>: <span class="string">&#x27;values&#x27;</span>&#125;</span><br><span class="line">r = requests.get(<span class="string">&#x27;[http:www.python123.io/ws](http://www.python123.io/ws)&#x27;</span>, params=kw)</span><br></pre></td></tr></table></figure><ul><li><p><code>data</code>：字典，字节序或文件对象，重点作为向服务器提供或提交资源是提交，，作为<code>request</code>的内容，与<code>params</code>不同的是，<code>data</code>提交的数据并不放在<code>url</code>链接里， 而是放在<code>url</code>链接对应位置的地方作为数据来存储。，它也可以接受一个字符串对象。</p></li><li><p><code>json</code>：<code>json</code>格式的数据， <code>json</code>合适在相关的<code>html</code>，<code>http</code>相关的<code>web</code>开发中非常常见， 也是<code>http</code>最经常使用的数据格式， 他是作为内容部分可以向服务器提交。</p><p>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kv = &#123;<span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://python123.io/ws&#x27;</span>, json=kv)</span><br></pre></td></tr></table></figure></li><li><p><code>headers</code>：字典是<code>http</code>的相关语，对应了向某个<code>url</code>访问时所发起的~的头i字段， 可以用这个字段来定义<code>http</code>的访问的<code>http</code>头，可以用来模拟任何我们想模拟的浏览器来对<code>url</code>发起访问。</p><p>例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hd = &#123;<span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Chrome/10&#x27;</span>&#125; </span><br><span class="line">r = requests.post(<span class="string">&#x27;http://python123.io/ws&#x27;</span>, headers=hd)</span><br></pre></td></tr></table></figure></li><li><p><code>cookies</code>：字典或<code>CookieJar</code>，指的是从<code>http</code>中解析<code>cookie</code></p></li><li><p><code>auth</code>：元组，用来支持<code>http</code>认证功能</p></li><li><p><code>files</code>：字典， 是用来向服务器传输文件时使用的字段。</p><p>例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fs = &#123;<span class="string">&#x27;files&#x27;</span>: open(<span class="string">&#x27;data.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125; </span><br><span class="line">r = requests.post(<span class="string">&#x27;http://python123.io/ws&#x27;</span>, files=fs)</span><br></pre></td></tr></table></figure></li><li><p><code>timeout</code>: 用于设定超时时间， 单位为秒，当发起一个<code>get</code>请求时可以设置一个<code>timeout</code>时间， 如果在<code>timeout</code>时间内请求内容没有返回， 将产生一个<code>timeout</code>的异常。</p></li><li><p><code>proxies</code>：字典， 用来设置访问代理服务器。</p></li><li><p><code>allow_redirects</code>: 开关， 表示是否允许对<code>url</code>进行重定向， 默认为<code>True</code>。</p></li><li><p><code>stream</code>: 开关， 指是否对获取内容进行立即下载， 默认为<code>True</code>。</p></li><li><p><code>verify</code>：开关， 用于认证<code>SSL</code>证书， 默认为<code>True</code>。</p></li><li><p><code>cert</code>： 用于设置保存本地<code>SSL</code>证书路径</p></li></ul><h5 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h5><table><thead><tr><th><strong>属性</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>r.status_code</code></td><td><code>http</code>请求的返回状态，若为<code>200</code>则表示请求成功。</td></tr><tr><td><code>r.text</code></td><td><code>http</code>响应内容的字符串形式，即返回的页面内容</td></tr><tr><td><code>r.encoding</code></td><td>从<code>http header</code> 中猜测的相应内容编码方式</td></tr><tr><td><code>r.apparent_encoding</code></td><td>从内容中分析出的响应内容编码方式（备选编码方式）</td></tr><tr><td><code>r.content</code></td><td><code>http</code>响应内容的二进制形式</td></tr></tbody></table><h5 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r=requests.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">r.status_code</span><br><span class="line"><span class="number">200</span></span><br><span class="line">r.encoding</span><br><span class="line"><span class="string">&#x27;ISO-8859-1&#x27;</span></span><br><span class="line">r.apparent_encoding</span><br><span class="line"><span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">r.text</span><br><span class="line"><span class="string">&#x27;&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;ipt&gt; &lt;a href=//www.baidu.com/more/ name=tj_briicon class=bri style=&quot;display: block;&quot;&gt;æ\x9b´å¤\x9aäº§å\x93\x81&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=ftCon&gt; &lt;div id=ftConw&gt; &lt;p id=lh&gt; &lt;a com/ class=cp-feedback&gt;æ\x84\x8fè§\x81å\x8f\x8dé¦\x88&lt;/a&gt;&amp;nbsp;äº¬ICPè¯\x81030173å\x8f·&amp;nbsp; &lt;img src=//www.baidu.com/img/gs.gif&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;\r\n&#x27;</span></span><br><span class="line">r.encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">r.text</span><br><span class="line"><span class="string">&#x27;&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta chref=http://s1.bdstatic.com/r/www/cache/bdorz/baidu.min.css=&quot;h读&lt;/a&gt;&amp;nbsp; &lt;a href=http://jianyi.baidu.com/ class=cp-feedback&gt;意见反馈&lt;/a&gt;&amp;nbsp;京ICP证030173号&amp;nbsp; &lt;img src=//www.baidu.com/img/gs.gif&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;\r\n&#x27;</span></span><br></pre></td></tr></table></figure><p>request库异常</p><p>注意<code>requests</code>库有时会产生异常，比如网络连接错误、<code>http</code>错误异常、重定向异常、请求<code>url</code>超时异常等等。所以我们需要判断<code>r.status_codes</code>是否是200，在这里我们怎么样去捕捉异常呢？</p><p>这里我们可以利用<code>r.raise_for_status()</code> 语句去捕捉异常，该语句在方法内部判断<code>r.status_code</code>是否等于200，如果不等于，则抛出异常。</p><p>于是在这里我们有一个爬取网页的通用代码框架：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r=requests.get(url,timeout=<span class="number">30</span>)<span class="comment">#请求超时时间为30秒</span></span><br><span class="line">    r.raise_for_status()<span class="comment">#如果状态不是200，则引发异常</span></span><br><span class="line">    r.encoding=r.apparent_encoding <span class="comment">#配置编码</span></span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;产生异常&quot;</span></span><br></pre></td></tr></table></figure><h4 id="request-head"><a href="#request-head" class="headerlink" title="request.head()"></a><code>request.head()</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r=requests.head(<span class="string">&quot;http://httpbin.org/get&quot;</span>)</span><br><span class="line">r.headers</span><br><span class="line"> &#123;<span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;Server&#x27;</span>: <span class="string">&#x27;meinheld/0.6.1&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>: <span class="string">&#x27;Mon, 20 Nov 2017 08:08:46 GMT&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>: <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;X-Powered-By&#x27;</span>: <span class="string">&#x27;Flask&#x27;</span>, <span class="string">&#x27;X-Processed-Time&#x27;</span>: <span class="string">&#x27;0.000658988952637&#x27;</span>, <span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;268&#x27;</span>, <span class="string">&#x27;Via&#x27;</span>: <span class="string">&#x27;1.1 vegur&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="requests-post"><a href="#requests-post" class="headerlink" title="requests.post()"></a><code>requests.post()</code></h4><h5 id="post一个字典"><a href="#post一个字典" class="headerlink" title="post一个字典"></a>post一个字典</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">payload=&#123;<span class="string">&quot;key1&quot;</span>:<span class="string">&quot;value1&quot;</span>,<span class="string">&quot;key2&quot;</span>:<span class="string">&quot;value2&quot;</span>&#125;</span><br><span class="line">r=requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>,data=payload)</span><br><span class="line">print(r.text)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">  <span class="string">&quot;files&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;form&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;key1&quot;</span>: <span class="string">&quot;value1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;key2&quot;</span>: <span class="string">&quot;value2&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;23&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.18.4&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;json&quot;</span>: null, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;218.197.153.150&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="post字符串"><a href="#post字符串" class="headerlink" title="post字符串"></a>post字符串</h5><h5 id="自动编码为data"><a href="#自动编码为data" class="headerlink" title="自动编码为data"></a>自动编码为data</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">r=requests.post(<span class="string">&quot;URL地址&quot;</span>,data=<span class="string">&#x27;helloworld&#x27;</span>)</span><br><span class="line">print(r.text)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="string">&quot;helloworld&quot;</span>, </span><br><span class="line">  <span class="string">&quot;files&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;form&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;10&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.18.4&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;json&quot;</span>: null, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;218.197.153.150&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;URL地址&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="post一个文件"><a href="#post一个文件" class="headerlink" title="post一个文件"></a>post一个文件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">files = &#123;<span class="string">&#x27;files&#x27;</span>:open(<span class="string">&#x27;F:\\python\\test\\test_case\\files.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>,files=files)</span><br><span class="line">print(r.text)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;args&quot;</span>:&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;files&quot;</span>:<span class="string">&quot;hello worle!&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;form&quot;</span>:&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;headers&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Length&quot;</span>:<span class="string">&quot;158&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;multipart/form-data; boundary=d2fb307f28aeb57b932d867f80f2f600&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>:<span class="string">&quot;httpbin.org&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;python-requests/2.19.1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;json&quot;</span>:null,</span><br><span class="line">    <span class="string">&quot;origin&quot;</span>:<span class="string">&quot;113.65.2.187&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;https://httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>put和patch与post类似，故不再做示例。</p><h2 id="requests代理"><a href="#requests代理" class="headerlink" title="requests代理"></a><code>requests</code>代理</h2><ul><li>什么是代理<ul><li>代理就是第三方代替本体处理相关事务。例如：生活中的代理：代购，中介，微商……</li></ul></li><li>爬虫中为什么需要使用代理<ul><li>一些网站会有相应的反爬虫措施，例如很多网站会检测某一段时间某个<code>IP</code>的访问次数，如果访问频率太快以至于看起来不像正常访客，它可能就会会禁止这个<code>IP</code>的访问。所以我们需要设置一些代理<code>IP</code>，每隔一段时间换一个代理<code>IP</code>，就算<code>IP</code>被禁止，依然可以换个<code>IP</code>继续爬取。</li></ul></li><li>代理的分类：<ul><li>正向代理：代理客户端获取数据。正向代理是为了保护客户端防止被追究责任。</li><li>反向代理：代理服务器提供数据。反向代理是为了保护服务器或负责负载均衡。</li></ul></li><li>免费代理<code>ip</code>提供网站<ul><li><span class="exturl" data-url="aHR0cDovL3d3dy5nb3ViYW5qaWEuY29tLw==">http://www.goubanjia.com/<i class="fa fa-external-link-alt"></i></span></li><li>西祠代理</li><li>快代理</li></ul></li></ul><p>百度<code>IP</code>，测试是否代理<code>ip</code>成功</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#不同浏览器的UA</span></span><br><span class="line">    header_list = [</span><br><span class="line">        <span class="comment"># 遨游</span></span><br><span class="line">        &#123;<span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Maxthon 2.0)&quot;</span>&#125;,</span><br><span class="line">        <span class="comment"># 火狐</span></span><br><span class="line">        &#123;<span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="comment"># 谷歌</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">#不同的代理IP</span></span><br><span class="line">    proxy_list = [</span><br><span class="line">        &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;112.115.57.20:3128&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;121.41.171.223:3128&#x27;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">#随机获取UA和代理IP</span></span><br><span class="line">    header = random.choice(header_list)</span><br><span class="line">    proxy = random.choice(proxy_list)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&#x27;http://www.baidu.com/s?ie=UTF-8&amp;wd=ip&#x27;</span></span><br><span class="line">    <span class="comment">#参数3：设置代理</span></span><br><span class="line">    response = requests.get(url=url,headers=header,proxies=proxy)</span><br><span class="line">    response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;daili.html&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(response.content)</span><br><span class="line">    <span class="comment">#切换成原来的IP</span></span><br><span class="line">    requests.get(url, proxies=&#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="会话维持"><a href="#会话维持" class="headerlink" title="会话维持"></a>会话维持</h2><p>会话对象让你能够跨请求保持某些参数。它也会在同一个 <code>Session</code> 实例发出的所有请求之间保持 <code>cookie</code>， 简单的说，如果你要爬取的页面是登录后才能查看的网页，那么就要像浏览器访问一样，保持其登录状态，者就用到了<code>session</code></p><h3 id="登录人人网"><a href="#登录人人网" class="headerlink" title="登录人人网"></a>登录人人网</h3><p>登录人人网，如果有验证码要识别其验证码，登录后下载其个人主页页面。在这里着重说下验证码吧，很多网站登录都需要验证码，人人网也一样，可能是在你多次输入账号密码错误的时候才会让你填写验证码。关于识别验证码我们这里使用到了第三方的<code>API</code>，云打码，市面上有很多类似的产品，大概原理就是访问登录页面时，将页面上的验证码下载下来，使用第三方<code>api</code>识别然后进行登录，具体的第三方都会提供文档和示例代码，这里就不详细解释。</p><h4 id="识别验证码文件"><a href="#识别验证码文件" class="headerlink" title="识别验证码文件"></a>识别验证码文件</h4><p><code>CodeDemo.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.client, mimetypes, urllib, json, time, requests</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YDMHttp</span>:</span></span><br><span class="line"></span><br><span class="line">    apiurl = <span class="string">&#x27;http://api.yundama.com/api.php&#x27;</span></span><br><span class="line">    username = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    appid = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    appkey = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, username, password, appid, appkey</span>):</span></span><br><span class="line">        self.username = username  </span><br><span class="line">        self.password = password</span><br><span class="line">        self.appid = str(appid)</span><br><span class="line">        self.appkey = appkey</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span>(<span class="params">self, fields, files=[]</span>):</span></span><br><span class="line">        response = self.post_url(self.apiurl, fields, files)</span><br><span class="line">        response = json.loads(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">balance</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;balance&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password, <span class="string">&#x27;appid&#x27;</span>: self.appid, <span class="string">&#x27;appkey&#x27;</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">&#x27;ret&#x27;</span>] <span class="keyword">and</span> response[<span class="string">&#x27;ret&#x27;</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;ret&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;balance&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password, <span class="string">&#x27;appid&#x27;</span>: self.appid, <span class="string">&#x27;appkey&#x27;</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">&#x27;ret&#x27;</span>] <span class="keyword">and</span> response[<span class="string">&#x27;ret&#x27;</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;ret&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;uid&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span>(<span class="params">self, filename, codetype, timeout</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;upload&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password, <span class="string">&#x27;appid&#x27;</span>: self.appid, <span class="string">&#x27;appkey&#x27;</span>: self.appkey, <span class="string">&#x27;codetype&#x27;</span>: str(codetype), <span class="string">&#x27;timeout&#x27;</span>: str(timeout)&#125;</span><br><span class="line">        file = &#123;<span class="string">&#x27;file&#x27;</span>: filename&#125;</span><br><span class="line">        response = self.request(data, file)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">&#x27;ret&#x27;</span>] <span class="keyword">and</span> response[<span class="string">&#x27;ret&#x27;</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;ret&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">&#x27;cid&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">result</span>(<span class="params">self, cid</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;result&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password, <span class="string">&#x27;appid&#x27;</span>: self.appid, <span class="string">&#x27;appkey&#x27;</span>: self.appkey, <span class="string">&#x27;cid&#x27;</span>: str(cid)&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">return</span> response <span class="keyword">and</span> response[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">self, filename, codetype, timeout</span>):</span></span><br><span class="line">        cid = self.upload(filename, codetype, timeout)</span><br><span class="line">        <span class="keyword">if</span> (cid &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, timeout):</span><br><span class="line">                result = self.result(cid)</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="string">&#x27;&#x27;</span>):</span><br><span class="line">                    <span class="keyword">return</span> cid, result</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-3003</span>, <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cid, <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span>(<span class="params">self, cid</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;report&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password, <span class="string">&#x27;appid&#x27;</span>: self.appid, <span class="string">&#x27;appkey&#x27;</span>: self.appkey, <span class="string">&#x27;cid&#x27;</span>: str(cid), <span class="string">&#x27;flag&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">return</span> response[<span class="string">&#x27;ret&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_url</span>(<span class="params">self, url, fields, files=[]</span>):</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> files:</span><br><span class="line">            files[key] = open(files[key], <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">        res = requests.post(url, files=files, data=fields)</span><br><span class="line">        <span class="keyword">return</span> res.text</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述代码不用理解其意思，就是第三方给我们提供的示例，拿来可以直接使用</p><h4 id="主代码"><a href="#主代码" class="headerlink" title="主代码"></a>主代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> CodeDemo <span class="keyword">import</span> YDMHttp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 识别验证码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">captcha</span>(<span class="params">username, password,appid,appkey, code_img=<span class="string">&#x27;getcode.jpg&#x27;</span>, codetype=<span class="number">1004</span></span>):</span></span><br><span class="line">    <span class="comment"># 超时时间，秒</span></span><br><span class="line">    timeout = <span class="number">60</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查</span></span><br><span class="line">    <span class="keyword">if</span> (username == <span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        print(<span class="string">&#x27;请设置好相关参数再测试&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 初始化</span></span><br><span class="line">        yundama = YDMHttp(username, password, appid, appkey)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 登陆云打码</span></span><br><span class="line">        uid = yundama.login();</span><br><span class="line">        print(<span class="string">&#x27;uid: %s&#x27;</span> % uid)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查询余额</span></span><br><span class="line">        balance = yundama.balance();</span><br><span class="line">        print(<span class="string">&#x27;balance: %s&#x27;</span> % balance)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 开始识别，图片路径，验证码类型ID，超时时间（秒），识别结果</span></span><br><span class="line">        cid, result = yundama.decode(code_img, codetype, timeout);</span><br><span class="line">        print(<span class="string">&#x27;cid: %s, result: %s&#x27;</span> % (cid, result))</span><br><span class="line">        <span class="comment"># 此处应该做判断，如果识别不出来返回空</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"><span class="comment"># 要保持会话的页面我们使用session.get/post之类的就可以了</span></span><br><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 登录视图页面</span></span><br><span class="line">login_view_url = <span class="string">&quot;http://www.renren.com/&quot;</span></span><br><span class="line"><span class="comment"># 获取登录视图源码</span></span><br><span class="line">login_view = requests.get(url=login_view_url, headers=headers).text</span><br><span class="line">tree = etree.HTML(login_view)</span><br><span class="line"><span class="comment"># 解析验证码图像地址</span></span><br><span class="line">code_url = tree.xpath(<span class="string">&#x27;//*[@id=&quot;verifyPic_login&quot;]/@src&#x27;</span>)</span><br><span class="line"><span class="comment"># 验证码</span></span><br><span class="line">code_num=<span class="literal">None</span></span><br><span class="line"><span class="comment"># 判断验证码是否存在，存在则识别验证码，不存在则跳过识别</span></span><br><span class="line"><span class="keyword">if</span> code_url:</span><br><span class="line">    <span class="comment"># 获取图片内容</span></span><br><span class="line">    code_img_content = requests.get(url=code_url[<span class="number">0</span>], headers=headers).content</span><br><span class="line">    <span class="comment"># 写入文件</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;getcode.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(code_img_content)</span><br><span class="line">    <span class="comment"># 获取验证码软件id， 软件key</span></span><br><span class="line">    code_num = captcha(username = <span class="string">&#x27;云打码普通用户名&#x27;</span>, password = <span class="string">&#x27;云打码普通用户密码&#x27;</span>, appid = <span class="number">9398</span>, appkey = <span class="string">&#x27;d34d4bc4bbbccf47f90f346d40a32aa2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录数据</span></span><br><span class="line"><span class="comment"># 登录数据这里是加密的，自己用浏览器登陆下，使用fiddler等抓包工具看下请求的数有哪些，并且看下加密后的密码</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;email&#x27;</span> : <span class="string">&#x27;646547989@qq.com&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;icode&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;origURL&#x27;</span>:<span class="string">&#x27;http://www.renren.com/home&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;domain&#x27;</span>:<span class="string">&#x27;renren.com&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;key_id&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;captcha_type&#x27;</span>:<span class="string">&#x27;web_login&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;6196c549890d45f3495cd55dcd0bb1e883dbdb1578be1ede58ceb57381df0850&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rkey&#x27;</span>:<span class="string">&#x27;088f9ddffb887cffe8956a6f85956689&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;f&#x27;</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#登录url</span></span><br><span class="line">login_url = <span class="string">&#x27;http://www.renren.com/ajaxLogin/login?1=1&amp;uniqueTimestamp=2019105950868&#x27;</span></span><br><span class="line"><span class="comment"># 登录网站</span></span><br><span class="line">session.post(url=login_url, data=data, headers=headers)</span><br><span class="line"><span class="comment"># 个人主页</span></span><br><span class="line">person_url = <span class="string">&#x27;http://www.renren.com/858420730/profile&#x27;</span></span><br><span class="line"><span class="comment"># 访问个人主页</span></span><br><span class="line">ret = session.get(url=person_url, headers=headers).content</span><br><span class="line"><span class="comment"># 下载个人主页</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;renren.html&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(ret)</span><br><span class="line">print(<span class="string">&#x27;可以了&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="登录古诗文网"><a href="#登录古诗文网" class="headerlink" title="登录古诗文网"></a>登录古诗文网</h3><p>我们依然要用到识别验证码，上述代码中的识别验证码部分这里就不上了，直接主体部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="comment"># 导入云打码类</span></span><br><span class="line"><span class="keyword">from</span> CodeDemo <span class="keyword">import</span> YDMHttp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 识别验证码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">captcha</span>(<span class="params">username, password,appid,appkey, code_img=<span class="string">&#x27;getcode.jpg&#x27;</span>, codetype=<span class="number">1004</span></span>):</span></span><br><span class="line">    <span class="comment"># 超时时间，秒</span></span><br><span class="line">    timeout = <span class="number">60</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查</span></span><br><span class="line">    <span class="keyword">if</span> (username == <span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        print(<span class="string">&#x27;请设置好相关参数再测试&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 初始化</span></span><br><span class="line">        yundama = YDMHttp(username, password, appid, appkey)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 登陆云打码</span></span><br><span class="line">        uid = yundama.login();</span><br><span class="line">        print(<span class="string">&#x27;uid: %s&#x27;</span> % uid)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查询余额</span></span><br><span class="line">        balance = yundama.balance();</span><br><span class="line">        print(<span class="string">&#x27;balance: %s&#x27;</span> % balance)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 开始识别，图片路径，验证码类型ID，超时时间（秒），识别结果</span></span><br><span class="line">        cid, result = yundama.decode(code_img, codetype, timeout);</span><br><span class="line">        print(<span class="string">&#x27;cid: %s, result: %s&#x27;</span> % (cid, result))</span><br><span class="line">        <span class="comment"># 此处应该做判断，如果识别不出来返回空</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 登录视图页面</span></span><br><span class="line">login_view_url = <span class="string">&quot;https://so.gushiwen.org/user/login.aspx&quot;</span></span><br><span class="line"><span class="comment"># 获取登录视图源码</span></span><br><span class="line">login_view = requests.get(url=login_view_url, headers=headers).text</span><br><span class="line">tree = etree.HTML(login_view)</span><br><span class="line"><span class="comment"># 解析验证码图像地址</span></span><br><span class="line">code_url = <span class="string">&#x27;https://so.gushiwen.org/&#x27;</span>+tree.xpath(<span class="string">&#x27;//*[@id=&quot;imgCode&quot;]/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">code_num = <span class="literal">None</span></span><br><span class="line"><span class="comment"># 判断验证码是否存在，存在则识别验证码，不存在则跳过识别</span></span><br><span class="line"><span class="keyword">if</span> code_url:</span><br><span class="line">    <span class="comment"># 获取图片内容</span></span><br><span class="line">    code_img_content = session.get(url=code_url, headers=headers).content</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;getcode.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(code_img_content)</span><br><span class="line">    code_num = captcha(username = <span class="string">&#x27;云打码普通用户名&#x27;</span>, password = <span class="string">&#x27;云打码普通密码&#x27;</span>, appid = <span class="number">9398</span>, appkey = <span class="string">&#x27;d34d4bc4bbbccf47f90f346d40a32aa2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录数据</span></span><br><span class="line"><span class="comment"># 同样使用抓包工具看下请求的数据都有哪些，__VIEWSTATE其实就是登陆表单中的表单令牌，密码呢这里没有先加密，填入你自己的密码就可以了</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;__VIEWSTATE&#x27;</span> :	<span class="string">&#x27;yEtGeGM9HT6bkfg7wOcpOXeXOr9S95S6ZRAVjyb7gUkABub2sKT687x3F07JHTOYv6UFDTIj7nYLJsaScMl3Wq75yPUrbD3wbOhC8q+yNJDWFL3KKHRPPLwiz0E=&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;__VIEWSTATEGENERATOR&#x27;</span>:	<span class="string">&#x27;C93BE1AE&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;from&#x27;</span>:	<span class="string">&#x27;http://so.gushiwen.org/user/collect.aspx&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;646547989@qq.com&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;pwd&#x27;</span>:	<span class="string">&#x27;你的密码&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>:	code_num,</span><br><span class="line"><span class="string">&#x27;denglu&#x27;</span>:	<span class="string">&#x27;登录&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 登陆请求地址</span></span><br><span class="line">login_url = <span class="string">&#x27;https://so.gushiwen.org/user/login.aspx&#x27;</span></span><br><span class="line"><span class="comment"># 登陆网站</span></span><br><span class="line">session.post(url=login_url, data=data, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 个人主页</span></span><br><span class="line">person_url = <span class="string">&#x27;https://so.gushiwen.org/user/collect.aspx&#x27;</span></span><br><span class="line"><span class="comment"># 访问个人收藏主页</span></span><br><span class="line">ret = session.get(url=person_url, headers=headers).content</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;gsw.html&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(ret)</span><br><span class="line">print(<span class="string">&#x27;可以了&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><p>我们这里使用多线程爬取视频。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests, re, time</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="comment">#我的电脑8核的，我们这里就开一个8线程的线程池</span></span><br><span class="line">pool = Pool(<span class="number">8</span>)</span><br><span class="line">url =<span class="string">&#x27;https://www.pearvideo.com/category_8&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.get(url=url, headers = headers).text</span><br><span class="line"></span><br><span class="line">tree = etree.HTML(res)</span><br><span class="line"><span class="comment"># 获取视频详情链接</span></span><br><span class="line">li_htmls = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;listvideoListUl&quot;]/li/div/a/@href&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 视频下载链接列表</span></span><br><span class="line">video_url_lis=[]</span><br><span class="line"><span class="comment"># 解析视频下载链接</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_url</span>(<span class="params">video_detail_url</span>):</span></span><br><span class="line">    video_detail = requests.get(url=<span class="string">&#x27;https://www.pearvideo.com/&#123;url&#125;&#x27;</span>.format(url=video_detail_url), headers=headers).text</span><br><span class="line">    video_url = re.findall(<span class="string">&#x27;srcUrl=&quot;(.*?)&quot;,vdoUrl&#x27;</span>, video_detail, re.S)[<span class="number">0</span>]</span><br><span class="line">    video_url_lis.append(video_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 视频内容列表</span></span><br><span class="line">video_content_lis=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_content</span>(<span class="params">video_url</span>):</span></span><br><span class="line">    video_content = requests.get(video_url, headers=headers).content</span><br><span class="line">    video_content_lis.append(video_content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载视频</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_video</span>(<span class="params">video_content</span>):</span></span><br><span class="line">    filename= <span class="string">&#x27;video/&#x27;</span>+str(uuid4())+<span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(video_content)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="comment"># 获取视频下载链接</span></span><br><span class="line">pool.map(get_video_url, li_htmls)</span><br><span class="line">print(video_url_lis)</span><br><span class="line"><span class="comment"># 获取视频内容</span></span><br><span class="line">pool.map(get_video_content, video_url_lis)</span><br><span class="line"><span class="comment"># 下载视频</span></span><br><span class="line">pool.map(download_video, video_content_lis)</span><br><span class="line">end = time.time()</span><br><span class="line">print(<span class="string">&#x27;总用时：&#x27;</span>, end-start)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="这里"><a href="#这里" class="headerlink" title="这里"></a>这里</h2><h3 id="爬取搜狗"><a href="#爬取搜狗" class="headerlink" title="爬取搜狗"></a>爬取搜狗</h3><p>请求载体身份标识的伪装：</p><ul><li><code>User-Agent</code>：请求载体身份标识，通过浏览器发起的请求，请求载体为浏览器，则该请求的<code>User-Agent</code>为浏览器的身份标识，使用爬虫程序发起的请求，则该请求的载体为爬虫程序，则该请求的<code>User-Agent</code>为爬虫程序的身份标识。可以通过判断该值来获知该请求的载体究竟是基于哪款浏览器还是基于爬虫程序。</li><li>反爬机制：某些门户网站会对访问该网站的请求中的<code>User-Agent</code>进行捕获和判断，如果该请求的<code>UA</code>为爬虫程序，则拒绝向该请求提供数据。</li><li>反反爬策略：将爬虫程序的<code>UA</code>伪装成某一款浏览器的身份标识。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#指定搜索关键字</span></span><br><span class="line">word = input(<span class="string">&#x27;enter a word you want to search:&#x27;</span>)</span><br><span class="line"><span class="comment">#自定义请求头信息</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#指定url</span></span><br><span class="line">url = <span class="string">&#x27;https://www.sogou.com/web&#x27;</span></span><br><span class="line"><span class="comment">#封装get请求参数</span></span><br><span class="line">prams = &#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>:word,</span><br><span class="line">    <span class="string">&#x27;ie&#x27;</span>:<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#发起请求</span></span><br><span class="line">response = requests.get(url=url,params=param)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取响应数据</span></span><br><span class="line">page_text = response.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;./sougou.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(page_text)</span><br></pre></td></tr></table></figure><h3 id="豆瓣电影排行榜"><a href="#豆瓣电影排行榜" class="headerlink" title="豆瓣电影排行榜"></a>豆瓣电影排行榜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">#指定ajax-get请求的url（通过抓包进行获取）</span></span><br><span class="line">    url = <span class="string">&#x27;https://movie.douban.com/j/chart/top_list?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#定制请求头信息，相关的头信息必须封装在字典结构中</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="comment">#定制请求头中的User-Agent参数，当然也可以定制请求头中其他的参数</span></span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#定制get请求携带的参数(从抓包工具中获取)</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;interval_id&#x27;</span>:<span class="string">&#x27;100:90&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;action&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;start&#x27;</span>:<span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;limit&#x27;</span>:<span class="string">&#x27;20&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#发起get请求，获取响应对象</span></span><br><span class="line">    response = requests.get(url=url,headers=headers,params=param)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取响应内容：响应内容为json串</span></span><br><span class="line">    print(response.text)</span><br></pre></td></tr></table></figure><h3 id="豆瓣登录数据"><a href="#豆瓣登录数据" class="headerlink" title="豆瓣登录数据"></a>豆瓣登录数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">url = <span class="string">&#x27;https://accounts.douban.com/login&#x27;</span></span><br><span class="line"><span class="comment">#封装请求参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;movie&quot;</span>,</span><br><span class="line">    <span class="string">&quot;redir&quot;</span>: <span class="string">&quot;https://movie.douban.com/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;form_email&quot;</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">    <span class="string">&quot;form_password&quot;</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">    <span class="string">&quot;login&quot;</span>: <span class="string">&quot;登录&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#自定义请求头信息</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">response = requests.post(url=url,data=data)</span><br><span class="line">page_text = response.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;./douban111.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(page_text)</span><br></pre></td></tr></table></figure><h3 id="药监局"><a href="#药监局" class="headerlink" title="药监局"></a>药监局</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"><span class="comment"># 随机设备标识，应对反爬虫</span></span><br><span class="line">ua = UserAgent(use_cache_server=<span class="literal">False</span>,verify_ssl=<span class="literal">False</span>).random</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:ua</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://125.35.6.84:81/xk/itownet/portalAction.do?method=getXkzsList&#x27;</span></span><br><span class="line">pageNum = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">3</span>,<span class="number">5</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;on&#x27;</span>: <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;page&#x27;</span>: str(page),</span><br><span class="line">        <span class="string">&#x27;pageSize&#x27;</span>: <span class="string">&#x27;15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;productName&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;conditionType&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;applyname&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;applysn&#x27;</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    json_text = requests.post(url=url,data=data,headers=headers).json()</span><br><span class="line">    all_id_list = []</span><br><span class="line">    <span class="keyword">for</span> dict <span class="keyword">in</span> json_text[<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">        id = dict[<span class="string">&#x27;ID&#x27;</span>]<span class="comment">#用于二级页面数据获取</span></span><br><span class="line">        <span class="comment">#下列详情信息可以在二级页面中获取</span></span><br><span class="line">        <span class="comment"># name = dict[&#x27;EPS_NAME&#x27;]</span></span><br><span class="line">        <span class="comment"># product = dict[&#x27;PRODUCT_SN&#x27;]</span></span><br><span class="line">        <span class="comment"># man_name = dict[&#x27;QF_MANAGER_NAME&#x27;]</span></span><br><span class="line">        <span class="comment"># d1 = dict[&#x27;XC_DATE&#x27;]</span></span><br><span class="line">        <span class="comment"># d2 = dict[&#x27;XK_DATE&#x27;]</span></span><br><span class="line">        all_id_list.append(id)</span><br><span class="line">    <span class="comment">#该url是一个ajax的post请求</span></span><br><span class="line">    post_url = <span class="string">&#x27;http://125.35.6.84:81/xk/itownet/portalAction.do?method=getXkzsById&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> id <span class="keyword">in</span>  all_id_list:</span><br><span class="line">        post_data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>:id</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url=post_url,data=post_data,headers=headers)</span><br><span class="line">        <span class="comment">#该请求响应回来的数据有两个，一个是基于text，一个是基于json的，所以可以根据content-type,来获取指定的响应数据</span></span><br><span class="line">        <span class="keyword">if</span> response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] == <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>:</span><br><span class="line">            <span class="comment">#print(response.json())</span></span><br><span class="line">            <span class="comment">#进行json解析</span></span><br><span class="line">            json_text = response.json()</span><br><span class="line">            print(json_text[<span class="string">&#x27;businessPerson&#x27;</span>])</span><br></pre></td></tr></table></figure></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/3348cce.html" rel="bookmark">从零开发手机app之爬取数据</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/aeca702.html" rel="bookmark">python之web自动化测试工具Selenium</a></div></li></ul><footer class="post-footer"><div class="reward-container"><div>打赏个鸡腿</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="托小尼 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="托小尼 支付宝"> <span>支付宝</span></div></div></div><div class="post-tags"><a href="/tags/python%E7%88%AC%E8%99%AB/" rel="tag"><i class="fa fa-tag"></i> python爬虫</a> <a href="/tags/%E7%88%AC%E8%99%AB/" rel="tag"><i class="fa fa-tag"></i> 爬虫</a> <a href="/tags/requests%E7%88%AC%E8%99%AB/" rel="tag"><i class="fa fa-tag"></i> requests爬虫</a> <a href="/tags/requests%E6%A8%A1%E5%9D%97/" rel="tag"><i class="fa fa-tag"></i> requests模块</a> <a href="/tags/python%E6%A8%A1%E6%8B%9F%E8%AE%BF%E9%97%AE%E7%BD%91%E5%9D%80/" rel="tag"><i class="fa fa-tag"></i> python模拟访问网址</a> <a href="/tags/python%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/" rel="tag"><i class="fa fa-tag"></i> python模拟登录</a> <a href="/tags/requests-get/" rel="tag"><i class="fa fa-tag"></i> requests.get</a> <a href="/tags/requests-post/" rel="tag"><i class="fa fa-tag"></i> requests.post</a> <a href="/tags/requests%E4%BB%A3%E7%90%86/" rel="tag"><i class="fa fa-tag"></i> requests代理</a> <a href="/tags/requests%E4%BB%A3%E7%90%86ip/" rel="tag"><i class="fa fa-tag"></i> requests代理ip</a> <a href="/tags/requests%E4%BC%AA%E8%A3%85%E4%BB%A3%E7%90%86/" rel="tag"><i class="fa fa-tag"></i> requests伪装代理</a> <a href="/tags/requests%E4%BC%AA%E8%A3%85ip/" rel="tag"><i class="fa fa-tag"></i> requests伪装ip</a> <a href="/tags/%E7%88%AC%E8%99%AB%E4%BB%A3%E7%90%86ip/" rel="tag"><i class="fa fa-tag"></i> 爬虫代理ip</a> <a href="/tags/python%E4%BB%A3%E7%90%86ip/" rel="tag"><i class="fa fa-tag"></i> python代理ip</a> <a href="/tags/%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3/" rel="tag"><i class="fa fa-tag"></i> 爬取豆瓣</a> <a href="/tags/%E6%A8%A1%E6%8B%9F%E4%BC%9A%E8%AF%9D/" rel="tag"><i class="fa fa-tag"></i> 模拟会话</a> <a href="/tags/%E4%BF%9D%E6%8C%81%E4%BC%9A%E8%AF%9D/" rel="tag"><i class="fa fa-tag"></i> 保持会话</a></div><div class="post-nav"><div class="post-nav-item"><a href="/b964d625.html" rel="prev" title="python处理excel之第三方库openpyxl"><i class="fa fa-chevron-left"></i> python处理excel之第三方库openpyxl</a></div><div class="post-nav-item"><a href="/aeca702.html" rel="next" title="python之web自动化测试工具Selenium">python之web自动化测试工具Selenium <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments"><div id="SOHUCS"></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">豫ICP备17028303号-1 </span><img src="http://www.beian.gov.cn/portal/download" style="display:inline-block"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5nb3YuY24vcG9ydGFsL3JlZ2lzdGVyU3lzdGVtSW5mbz9yZWNvcmRjb2RlPTE3MDI4MzAz">豫公网安备 41102402000095号</span></div><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Tony Yu</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">1.1m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">16:22</span></span></div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1.15.0/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments('#SOHUCS', () => {
    NexT.utils.getScript('https://changyan.sohu.com/upload/changyan.js', () => {
      window.changyan.api.config({
        appid: 'cyu11Umgd',
        conf : '0f296687f6a61e82028fd7c6ddf32ab9'
      });
    });
  });</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script></body></html>