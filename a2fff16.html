<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/56x56logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/400x400logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.diandian100.cn",root:"/",scheme:"Gemini",version:"8.0.0",exturl:!0,sidebar:{position:"left",display:"always",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"},path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="之前一直没有使用过FastDFS，直到都使用了各大平台的oss存储对象也没有用过它，最近抱着学习的态度尝试使用一下FastDFS。"><meta property="og:type" content="article"><meta property="og:title" content="手把手教你在项目中使用FastDFS"><meta property="og:url" content="https://www.diandian100.cn/a2fff16.html"><meta property="og:site_name" content="点点开发技术分享"><meta property="og:description" content="之前一直没有使用过FastDFS，直到都使用了各大平台的oss存储对象也没有用过它，最近抱着学习的态度尝试使用一下FastDFS。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160107.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160132.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160200.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160226.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160255.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160325.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160406.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162338.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162444.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162623.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108164210.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108165804.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108165958.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108173055.png"><meta property="og:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108174157.png"><meta property="article:published_time" content="2021-01-04T02:02:11.000Z"><meta property="article:modified_time" content="2021-01-11T05:23:25.000Z"><meta property="article:author" content="托小尼"><meta property="article:tag" content="client"><meta property="article:tag" content="FastDFS"><meta property="article:tag" content="分布式文件系统"><meta property="article:tag" content="文件存储系统"><meta property="article:tag" content="文件存储系统搭建"><meta property="article:tag" content="fastdfs配置"><meta property="article:tag" content="fastdfs使用"><meta property="article:tag" content="django使用fastdfs"><meta property="article:tag" content="elasticsearch"><meta property="article:tag" content="django使用elasticsearch"><meta property="article:tag" content="tracker"><meta property="article:tag" content="storage"><meta property="article:tag" content="跟踪服务器"><meta property="article:tag" content="存储服务器"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160107.png"><link rel="canonical" href="https://www.diandian100.cn/a2fff16.html"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>手把手教你在项目中使用FastDFS | 点点开发技术分享</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3b57832214417f66931e694d19fd60b9";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">点点开发技术分享</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">记录个人日常开发笔记与技巧</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-development"><a href="/categories/rd/" rel="section"><i class="fa fa-code fa-fw"></i>开发</a></li><li class="menu-item menu-item-frontend"><a href="/categories/fe/" rel="section"><i class="fab fa-html5 fa-fw"></i>前端</a></li><li class="menu-item menu-item-database"><a href="/categories/db/" rel="section"><i class="fa fa-database fa-fw"></i>数据库</a></li><li class="menu-item menu-item-os"><a href="/categories/os/" rel="section"><i class="fab fa-linux fa-fw"></i>系统</a></li><li class="menu-item menu-item-other"><a href="/categories/other/" rel="section"><i class="far fa-paper-plane fa-fw"></i>其他</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">分布式文件系统发展历程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E6%9C%BA%E6%97%B6%E4%BB%A3"><span class="nav-number">1.1.</span> <span class="nav-text">单机时代</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8B%AC%E7%AB%8B%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.2.</span> <span class="nav-text">独立文件服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.3.</span> <span class="nav-text">分布式文件系统</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FastDFS"><span class="nav-number">2.</span> <span class="nav-text">FastDFS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFFastDFS"><span class="nav-number">2.1.</span> <span class="nav-text">什么是FastDFS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FastDFS%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="nav-number">2.2.</span> <span class="nav-text">FastDFS相关概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%BC%A0%E6%9C%BA%E5%88%B6"><span class="nav-number">2.3.</span> <span class="nav-text">上传机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="nav-number">2.4.</span> <span class="nav-text">下载机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86"><span class="nav-number">2.5.</span> <span class="nav-text">同步时间管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B2%BE%E5%B7%A7%E7%9A%84%E6%96%87%E4%BB%B6ID-FID"><span class="nav-number">2.6.</span> <span class="nav-text">精巧的文件ID-FID</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FastDFS%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">FastDFS安装配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="nav-number">3.1.</span> <span class="nav-text">前期准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96FastDFS%E9%95%9C%E5%83%8F"><span class="nav-number">3.2.</span> <span class="nav-text">获取FastDFS镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AFtracker%E5%AE%B9%E5%99%A8"><span class="nav-number">3.3.</span> <span class="nav-text">开启tracker容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AFstorage%E5%AE%B9%E5%99%A8"><span class="nav-number">3.4.</span> <span class="nav-text">开启storage容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%98%A0%E5%B0%84%E8%B7%AF%E5%BE%84"><span class="nav-number">3.5.</span> <span class="nav-text">查看宿主机映射路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Btracker%E5%92%8Cstorage%E9%95%9C%E5%83%8F%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81"><span class="nav-number">3.6.</span> <span class="nav-text">查看tracker和storage镜像运行状态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django%E4%B8%AD%E4%BD%BF%E7%94%A8FastDFS"><span class="nav-number">4.</span> <span class="nav-text">Django中使用FastDFS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Django%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87"><span class="nav-number">4.1.</span> <span class="nav-text">Django项目准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FastDFS%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-number">4.2.</span> <span class="nav-text">FastDFS上传文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85FastDFS%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%89%A9%E5%B1%95"><span class="nav-number">4.2.1.</span> <span class="nav-text">安装FastDFS客户端扩展</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%87%86%E5%A4%87FastDFS%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%89%A9%E5%B1%95%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.2.2.</span> <span class="nav-text">准备FastDFS客户端扩展配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#FastDFS%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="nav-number">4.2.3.</span> <span class="nav-text">FastDFS客户端实现文件存储</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%B8%B2%E6%9F%93%E6%96%87%E4%BB%B6"><span class="nav-number">4.3.</span> <span class="nav-text">下载渲染文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E6%8E%A5Django"><span class="nav-number">4.4.</span> <span class="nav-text">对接Django</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Django%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%B1%BB"><span class="nav-number">4.4.1.</span> <span class="nav-text">自定义Django文件存储类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.2.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%A8%A1%E6%9D%BF%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80%E8%B0%83%E7%94%A8"><span class="nav-number">4.4.3.</span> <span class="nav-text">修改模板图片地址调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.4.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="托小尼" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">托小尼</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">203</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">55</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">1303</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cDovL3dwYS5xcS5jb20vbXNncmQ/dj0zJnVpbj02NDY1NDc5ODkmc2l0ZT1xcSZtZW51PXllcw==" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;646547989&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="fab fa-qq fa-fw"></i>QQ</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOnRvbnl5dUB2aXAucXEuY29t" title="E-Mail → mailto:tonyyu@vip.qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span></span></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Rvbnl1MjAxOQ==" title="关注我" aria-label="关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.diandian100.cn/a2fff16.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="托小尼"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="点点开发技术分享"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">手把手教你在项目中使用FastDFS</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-01-04 10:02:11" itemprop="dateCreated datePublished" datetime="2021-01-04T10:02:11+08:00">2021-01-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-11 13:23:25" itemprop="dateModified" datetime="2021-01-11T13:23:25+08:00">2021-01-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/rd/" itemprop="url" rel="index"><span itemprop="name">rd</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/rd/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan：</span> <a title="changyan" href="/a2fff16.html#SOHUCS" itemprop="discussionUrl"><span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="a2fff16.html" itemprop="commentCount"></span></a></span></div><div class="post-meta"><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>14k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>之前一直没有使用过FastDFS，直到都使用了各大平台的oss存储对象也没有用过它，最近抱着学习的态度尝试使用一下FastDFS。</p><a id="more"></a><p>说到FastDFS不得不提一个问题：为什么要使用分布式文件系统？时代的发展必然引起需求的变化，根据各个时期的需求我们来看下分布式文件系统的发展历程和由来。</p><h3 id="分布式文件系统发展历程"><a href="#分布式文件系统发展历程" class="headerlink" title="分布式文件系统发展历程"></a>分布式文件系统发展历程</h3><h4 id="单机时代"><a href="#单机时代" class="headerlink" title="单机时代"></a>单机时代</h4><p>初创时期由于时间紧迫，在各种资源有限的情况下，通常就直接在项目目录下建立静态文件夹，用于用户存放项目中的文件资源。如果按不同类型再细分，可以在项目目录下再建立不同的子目录来区分。例如：<code>resources\static\file</code>、<code>resources\static\img</code>、<code>uploads</code>等。</p><p><strong>优点</strong>：这样做比较便利，项目直接引用就行，实现起来也简单，无需任何复杂技术，保存数据库记录和访问起来也很方便。</p><p><strong>缺点</strong>：如果只是后台系统的使用一般也不会有什么问题，但是作为一个前端网站使用的话就会存在弊端。一方面，文件和代码耦合在一起，文件越多存放越混乱；另一方面，如果流量比较大，静态文件访问会占据一定的资源，影响正常业务进行，不利于网站快速发展。</p><h4 id="独立文件服务器"><a href="#独立文件服务器" class="headerlink" title="独立文件服务器"></a>独立文件服务器</h4><p>随着公司业务不断发展，将代码和文件放在同一服务器的弊端就会越来越明显。为了解决上面的问题引入独立图片服务器，工作流程如下：项目上传文件时，首先通过ftp或者ssh将文件上传到图片服务器的某个目录下，再通过ngnix或者apache来访问此目录下的文件，返回一个独立域名的图片URL地址，前端使用文件时就通过这个URL地址读取。</p><p><strong>优点</strong>：图片访问是很消耗服务器资源的（因为会涉及到操作系统的上下文切换和磁盘I/O操作），分离出来后，Web/App服务器可以更专注发挥动态处理的能力；独立存储，更方便做扩容、容灾和数据迁移；方便做图片访问请求的负载均衡，方便应用各种缓存策略（HTTP Header、Proxy Cache等），也更加方便迁移到CDN。</p><p><strong>缺点</strong>：单机存在性能瓶颈，容灾、垂直扩展性稍差</p><h4 id="分布式文件系统"><a href="#分布式文件系统" class="headerlink" title="分布式文件系统"></a>分布式文件系统</h4><p>通过独立文件服务器可以解决一些问题，如果某天存储文件的那台服务突然down了怎么办？可能你会说，定时将文件系统备份，这台down机的时候，迅速切换到另一台就OK了，但是这样处理需要人工来干预。另外，当存储的文件超过100T的时候怎么办？单台服务器的性能问题？这个时候我们就应该考虑分布式文件系统了。</p><p>业务继续发展，单台服务器存储和响应也很快到达了瓶颈，新的业务需要文件访问具有高响应性、高可用性来支持系统。分布式文件系统，一般分为三块内容来配合，服务的存储、访问的仲裁系统，文件存储系统，文件的容灾系统来构成，仲裁系统相当于文件服务器的大脑，根据一定的算法来决定文件存储的位置，文件存储系统负责保存文件，容灾系统负责文件系统和自己的相互备份。</p><p><strong>优点</strong>：扩展能力: 毫无疑问，扩展能力是一个分布式文件系统最重要的特点；高可用性: 在分布式文件系统中，高可用性包含两层，一是整个文件系统的可用性，二是数据的完整和一致性；弹性存储: 可以根据业务需要灵活地增加或缩减数据存储以及增删存储池中的资源，而不需要中断系统运行</p><p><strong>缺点</strong>：系统复杂度稍高，需要更多服务器</p><h3 id="FastDFS"><a href="#FastDFS" class="headerlink" title="FastDFS"></a>FastDFS</h3><p>由上面文件系统的发展历程引入了我们今天的猪脚FastDFS，我们先在前面抛出这样的概念，后面用一个实例来演示如何安装及使用FastDFS。</p><h4 id="什么是FastDFS"><a href="#什么是FastDFS" class="headerlink" title="什么是FastDFS"></a>什么是FastDFS</h4><p>FastDFS是一个开源的轻量级分布式文件系统。它解决了大数据量存储和负载均衡等问题。特别适合以中小文件（建议范围：4KB &lt; file_size &lt;500MB）为载体的在线服务，如相册网站、视频网站等等。在UC基于FastDFS开发向用户提供了：网盘，社区，广告和应用下载等业务的存储服务。</p><p>FastDFS是一款开源的轻量级分布式文件系统纯C实现，支持Linux、FreeBSD等UNIX系统类google FS，不是通用的文件系统，只能通过专有API访问，目前提供了C、Java和PHP API为互联网应用量身定做，解决大容量文件存储问题，追求高性能和高扩展性FastDFS可以看做是基于文件的key value pair存储系统，称作分布式文件存储服务更为合适。</p><p><strong>FastDFS特性</strong>：</p><ul><li>文件不分块存储，上传的文件和OS文件系统中的文件一一对应</li><li>支持相同内容的文件只保存一份，节约磁盘空间</li><li>下载文件支持HTTP协议，可以使用内置Web Server，也可以和其他Web Server配合使用</li><li>支持在线扩容</li><li>支持主从文件</li><li>存储服务器上可以保存文件属性（meta-data）V2.0网络通信采用libevent，支持大并发访问，整体性能更好</li></ul><h4 id="FastDFS相关概念"><a href="#FastDFS相关概念" class="headerlink" title="FastDFS相关概念"></a>FastDFS相关概念</h4><p>FastDFS服务端有三个角色：跟踪服务器（tracker server）、存储服务器（storage server）和客户端（client）。</p><p><strong>tracker server</strong>：跟踪服务器，主要做调度工作，起负载均衡的作用。在内存中记录集群中所有存储组和存储服务器的状态信息，是客户端和数据服务器交互的枢纽。相比GFS中的master更为精简，不记录文件索引信息，占用的内存量很少。</p><p>Tracker是FastDFS的协调者，负责管理所有的storage server和group，每个storage在启动后会连接Tracker，告知自己所属的group等信息，并保持周期性的心跳，tracker根据storage的心跳信息，建立group==&gt;[storage server list]的映射表。</p><p>Tracker需要管理的元信息很少，会全部存储在内存中；另外tracker上的元信息都是由storage汇报的信息生成的，本身不需要持久化任何数据，这样使得tracker非常容易扩展，直接增加tracker机器即可扩展为tracker cluster来服务，cluster里每个tracker之间是完全对等的，所有的tracker都接受stroage的心跳信息，生成元数据信息来提供读写服务。</p><p><strong>storage server</strong>：存储服务器（又称：存储节点或数据服务器），文件和文件属性（meta data）都保存到存储服务器上。Storage server直接利用OS的文件系统调用管理文件。</p><p>Storage server（后简称storage）以组（卷，group或volume）为单位组织，一个group内包含多台storage机器，数据互为备份，存储空间以group内容量最小的storage为准，所以建议group内的多个storage尽量配置相同，以免造成存储空间的浪费。</p><p>以group为单位组织存储能方便的进行应用隔离、负载均衡、副本数定制（group内storage server数量即为该group的副本数），比如将不同应用数据存到不同的group就能隔离应用数据，同时还可根据应用的访问特性来将应用分配到不同的group来做负载均衡；缺点是group的容量受单机存储容量的限制，同时当group内有机器坏掉时，数据恢复只能依赖group内地其他机器，使得恢复时间会很长。</p><p>group内每个storage的存储依赖于本地文件系统，storage可配置多个数据存储目录，比如有10块磁盘，分别挂载在<code>/data/disk1-/data/disk10</code>，则可将这10个目录都配置为storage的数据存储目录。</p><p>storage接受到写文件请求时，会根据配置好的规则（后面会介绍），选择其中一个存储目录来存储文件。为了避免单个目录下的文件数太多，在storage第一次启动时，会在每个数据存储目录里创建2级子目录，每级256个，总共65536个文件，新写的文件会以hash的方式被路由到其中某个子目录下，然后将文件数据直接作为一个本地文件存储到该目录中。</p><p><strong>client</strong>：客户端，作为业务请求的发起方，通过专有接口，使用TCP/IP协议与跟踪器服务器或存储节点进行数据交互。FastDFS向使用者提供基本文件访问接口，比如upload、download、append、delete等，以客户端库的方式提供给用户使用。</p><p>另外两个概念：</p><p><strong>group</strong> ：组， 也可称为卷。 同组内服务器上的文件是完全相同的 ，同一组内的storage server之间是对等的， 文件上传、 删除等操作可以在任意一台storage server上进行 。</p><p><strong>meta data</strong> ：文件相关属性，键值对（ Key Value Pair） 方式，如：width=1024,heigth=768 。</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160107.png"></p><p>Tracker相当于FastDFS的大脑，不论是上传还是下载都是通过tracker来分配资源；客户端一般可以使用ngnix等静态服务器来调用或者做一部分的缓存；存储服务器内部分为卷（或者叫做组），卷于卷之间是平行的关系，可以根据资源的使用情况随时增加，卷内服务器文件相互同步备份，以达到容灾的目的。</p><h4 id="上传机制"><a href="#上传机制" class="headerlink" title="上传机制"></a>上传机制</h4><p>首先客户端请求Tracker服务获取到存储服务器的ip地址和端口，然后客户端根据返回的IP地址和端口号请求上传文件，存储服务器接收到请求后生产文件，并且将文件内容写入磁盘并返回给客户端file_id、路径信息、文件名等信息，客户端保存相关信息上传完毕。</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160132.png"></p><p>内部机制如下：</p><p><strong>1、选择tracker server</strong></p><p>当集群中不止一个tracker server时，由于tracker之间是完全对等的关系，客户端在upload文件时可以任意选择一个trakcer。 选择存储的group 当tracker接收到upload file的请求时，会为该文件分配一个可以存储该文件的group，支持如下选择group的规则：</p><ul><li>1、Round robin，所有的group间轮询</li><li>2、Specified group，指定某一个确定的group</li><li>3、Load balance，剩余存储空间多多group优先</li></ul><p><strong>2、选择storage server</strong></p><p>当选定group后，tracker会在group内选择一个storage server给客户端，支持如下选择storage的规则：</p><ul><li>1、Round robin，在group内的所有storage间轮询</li><li>2、First server ordered by ip，按ip排序</li><li>3、First server ordered by priority，按优先级排序（优先级在storage上配置）</li></ul><p><strong>3、选择storage path</strong></p><p>当分配好storage server后，客户端将向storage发送写文件请求，storage将会为文件分配一个数据存储目录，支持如下规则：</p><ul><li>1、Round robin，多个存储目录间轮询</li><li>2、剩余存储空间最多的优先</li></ul><p><strong>4、生成Fileid</strong></p><p>选定存储目录之后，storage会为文件生一个Fileid，由storage server ip、文件创建时间、文件大小、文件crc32和一个随机数拼接而成，然后将这个二进制串进行base64编码，转换为可打印的字符串。 选择两级目录 当选定存储目录之后，storage会为文件分配一个fileid，每个存储目录下有两级256*256的子目录，storage会按文件fileid进行两次hash（猜测），路由到其中一个子目录，然后将文件以fileid为文件名存储到该子目录下。</p><p><strong>5、生成文件名</strong></p><p>当文件存储到某个子目录后，即认为该文件存储成功，接下来会为该文件生成一个文件名，文件名由group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</p><h4 id="下载机制"><a href="#下载机制" class="headerlink" title="下载机制"></a>下载机制</h4><p>客户端带上文件名信息请求Tracker服务获取到存储服务器的ip地址和端口，然后客户端根据返回的IP地址和端口号请求下载文件，存储服务器接收到请求后返回文件给客户端。</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160200.png"></p><p>跟upload file一样，在download file时客户端可以选择任意tracker server。tracker发送download请求给某个tracker，必须带上文件名信息，tracke从文件名中解析出文件的group、大小、创建时间等信息，然后为该请求选择一个storage用来服务读请求。由于group内的文件同步时在后台异步进行的，所以有可能出现在读到时候，文件还没有同步到某些storage server上，为了尽量避免访问到这样的storage，tracker按照如下规则选择group内可读的storage。</p><ul><li>1、该文件上传到的源头storage - 源头storage只要存活着，肯定包含这个文件，源头的地址被编码在文件名中。</li><li>2、文件创建时间戳==storage被同步到的时间戳 且(当前时间-文件创建时间戳) &gt; 文件同步最大时间（如5分钟) - 文件创建后，认为经过最大同步时间后，肯定已经同步到其他storage了。</li><li>3、文件创建时间戳 &lt; storage被同步到的时间戳。 - 同步时间戳之前的文件确定已经同步了</li><li>4、(当前时间-文件创建时间戳) &gt; 同步延迟阀值（如一天）。 - 经过同步延迟阈值时间，认为文件肯定已经同步了。</li></ul><h4 id="同步时间管理"><a href="#同步时间管理" class="headerlink" title="同步时间管理"></a>同步时间管理</h4><p>当一个文件上传成功后，客户端马上发起对该文件下载请求（或删除请求）时，tracker是如何选定一个适用的存储服务器呢？ 其实每个存储服务器都需要定时将自身的信息上报给tracker，这些信息就包括了本地同步时间（即，同步到的最新文件的时间戳）。而tracker根据各个存储服务器的上报情况，就能够知道刚刚上传的文件，在该存储组中是否已完成了同步。同步信息上报如下图：</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160226.png"></p><p>写文件时，客户端将文件写至group内一个storage server即认为写文件成功，storage server写完文件后，会由后台线程将文件同步至同group内其他的storage server。</p><p>每个storage写文件后，同时会写一份binlog，binlog里不包含文件数据，只包含文件名等元信息，这份binlog用于后台同步，storage会记录向group内其他storage同步的进度，以便重启后能接上次的进度继续同步；进度以时间戳的方式进行记录，所以最好能保证集群内所有server的时钟保持同步。</p><p>storage的同步进度会作为元数据的一部分汇报到tracker上，tracke在选择读storage的时候会以同步进度作为参考。 比如一个group内有A、B、C三个storage server，A向C同步到进度为T1 (T1以前写的文件都已经同步到B上了），B向C同步到时间戳为T2（T2 &gt; T1)，tracker接收到这些同步进度信息时，就会进行整理，将最小的那个做为C的同步时间戳，本例中T1即为C的同步时间戳为T1（即所有T1以前写的数据都已经同步到C上了）；同理，根据上述规则，tracker会为A、B生成一个同步时间戳。</p><h4 id="精巧的文件ID-FID"><a href="#精巧的文件ID-FID" class="headerlink" title="精巧的文件ID-FID"></a>精巧的文件ID-FID</h4><p>说到下载就不得不提文件索引（又称：FID）的精巧设计了。文件索引结构如下图，是客户端上传文件后存储服务器返回给客户端，用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160255.png"></p><ul><li>组名：文件上传后所在的存储组名称，在文件上传成功后有存储服务器返回，需要客户端自行保存。</li><li>虚拟磁盘路径：存储服务器配置的虚拟路径，与磁盘选项store_path*对应。</li><li>数据两级目录：存储服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据文件。</li><li>文件名：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储服务器IP地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。</li></ul><p><strong>快速定位文件</strong></p><p>知道FastDFS FID的组成后，我们来看看FastDFS是如何通过这个精巧的FID定位到需要访问的文件。</p><ul><li>1、通过组名tracker能够很快的定位到客户端需要访问的存储服务器组，并将选择合适的存储服务器提供客户端访问；</li><li>2、存储服务器根据“文件存储虚拟磁盘路径”和“数据文件两级目录”可以很快定位到文件所在目录，并根据文件名找到客户端需要访问的文件。</li></ul><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160325.png"></p><p>FastDFS搭建的架构示意图</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108160406.png"></p><h3 id="FastDFS安装配置"><a href="#FastDFS安装配置" class="headerlink" title="FastDFS安装配置"></a>FastDFS安装配置</h3><p>关于FastDFS安装配置个人感觉还是有些复杂的，另外过程中也是遇到了很多坑，我这里就不一一常规安装了(可以参考来源里的文章)，网上有大神给我们已经配置好了FastDFS的docker镜像了，我们可以直接使用docker镜像去安装它，省时又跳坑，特别是对小白也很友好。</p><h4 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h4><p>为了演示我这里准备了一台iMac(任意电脑系统)、vm中安装了一个Ubuntu虚拟机(有条件可以是独立电脑或服务器)作为我们的FastDFS服务器。</p><h4 id="获取FastDFS镜像"><a href="#获取FastDFS镜像" class="headerlink" title="获取FastDFS镜像"></a>获取FastDFS镜像</h4><p>在Ubuntu中安装docker并获取FastDFS镜像，关于docker的安装和使用可参考之前的文章：<a href="https://www.diandian100.cn/bce2e291.html?highlight=docker">Deepin下安装Docker</a>、<a href="https://www.diandian100.cn/cf791c57.html?highlight=docker">Docker基础使用</a>、<a href="https://www.diandian100.cn/c2780ebb.html?highlight=docker">Dockerfile基本使用及打包镜像</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从仓库拉取镜像</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker image pull delron/fastdfs</span></span><br></pre></td></tr></table></figure><h4 id="开启tracker容器"><a href="#开启tracker容器" class="headerlink" title="开启tracker容器"></a>开启tracker容器</h4><p>我们将 tracker 运行目录映射到宿主机(Ubuntu)的 <code>/var/fdfs/tracker</code>目录中。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo docker run -dit --name tracker --network=host -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker</span></span><br></pre></td></tr></table></figure><h4 id="开启storage容器"><a href="#开启storage容器" class="headerlink" title="开启storage容器"></a>开启storage容器</h4><p>TRACKER_SERVER=Tracker的ip地址:22122（Tracker的ip地址不要使用127.0.0.1）；我们将 storage 运行目录映射到宿主机的 <code>/var/fdfs/storage</code>目录中。tracker的ip地址即其宿主机Ubuntu的ip。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo docker run -dti --name storage --network=host -e TRACKER_SERVER=172.16.178.129:22122 -v /var/fdfs/storage:/var/fdfs delron/fastdfs storage</span></span><br></pre></td></tr></table></figure><h4 id="查看宿主机映射路径"><a href="#查看宿主机映射路径" class="headerlink" title="查看宿主机映射路径"></a>查看宿主机映射路径</h4><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162338.png"></p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162444.png"></p><p><strong>注意：如果无法重启storage容器，可以删除<code>/var/fdfs/storage/data</code>目录下的<code>fdfs_storaged.pid</code> 文件，然后重新运行storage。</strong></p><h4 id="查看tracker和storage镜像运行状态"><a href="#查看tracker和storage镜像运行状态" class="headerlink" title="查看tracker和storage镜像运行状态"></a>查看tracker和storage镜像运行状态</h4><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108162623.png"></p><p>经过以上步骤我们的FastDFS就安装好了，可以使用了，下面我们以Django为例，看如何在DJango中使用FastDFS</p><h3 id="Django中使用FastDFS"><a href="#Django中使用FastDFS" class="headerlink" title="Django中使用FastDFS"></a>Django中使用FastDFS</h3><h4 id="Django项目准备"><a href="#Django项目准备" class="headerlink" title="Django项目准备"></a>Django项目准备</h4><p>结构及数据模型如下</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108164210.png"></p><h4 id="FastDFS上传文件"><a href="#FastDFS上传文件" class="headerlink" title="FastDFS上传文件"></a>FastDFS上传文件</h4><h5 id="安装FastDFS客户端扩展"><a href="#安装FastDFS客户端扩展" class="headerlink" title="安装FastDFS客户端扩展"></a>安装FastDFS客户端扩展</h5><p>扩展仓库为<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0phY2VIby9mZGZzX2NsaWVudC1weSVFRiVCQyU4QyVFNiU4OCU5MSVFNCVCQiVBQyVFNSVCNyVCMiVFNyVCQiU4RiVFNiU4RiU5MCVFNSU4OSU4RCVFNCVCOCU4QiVFOCVCRCVCRCVFNSVBNSVCRCVFNCVCQSU4NiVFMyU4MCU4Mg==">https://github.com/JaceHo/fdfs_client-py，我们已经提前下载好了。<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install fdfs_client-py-master.zip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install mutagen</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip isntall requests</span></span><br></pre></td></tr></table></figure><p>后面运行中如果报错：<a href="https://www.diandian100.cn/898d455c.html?highlight=mutagen">ModuleNotFoundError: No module named ‘mutagen._compat’</a></p><h5 id="准备FastDFS客户端扩展配置文件"><a href="#准备FastDFS客户端扩展配置文件" class="headerlink" title="准备FastDFS客户端扩展配置文件"></a>准备FastDFS客户端扩展配置文件</h5><p><code>FastDFS_ElasticSearch/utils/fastdfs_client.conf</code>,内容如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># connect timeout in seconds</span></span><br><span class="line"><span class="comment"># default value is 30s</span></span><br><span class="line"><span class="attr">connect_timeout</span>=<span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># network timeout in seconds</span></span><br><span class="line"><span class="comment"># default value is 30s</span></span><br><span class="line"><span class="attr">network_timeout</span>=<span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the base path to store log files</span></span><br><span class="line"><span class="attr">base_path</span>=/Users/Tony/fdfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># tracker_server can ocur more than once, and tracker_server format is</span></span><br><span class="line"><span class="comment">#  &quot;host:port&quot;, host can be hostname or ip address</span></span><br><span class="line"><span class="attr">tracker_server</span>=<span class="number">172.16</span>.<span class="number">178.129</span>:<span class="number">22122</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#standard log level as syslog, case insensitive, value list:</span></span><br><span class="line"><span class="comment">### emerg for emergency</span></span><br><span class="line"><span class="comment">### alert</span></span><br><span class="line"><span class="comment">### crit for critical</span></span><br><span class="line"><span class="comment">### error</span></span><br><span class="line"><span class="comment">### warn for warning</span></span><br><span class="line"><span class="comment">### notice</span></span><br><span class="line"><span class="comment">### info</span></span><br><span class="line"><span class="comment">### debug</span></span><br><span class="line"><span class="attr">log_level</span>=info</span><br><span class="line"></span><br><span class="line"><span class="comment"># if use connection pool</span></span><br><span class="line"><span class="comment"># default value is false</span></span><br><span class="line"><span class="comment"># since V4.05</span></span><br><span class="line"><span class="attr">use_connection_pool</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># connections whose the idle time exceeds this time will be closed</span></span><br><span class="line"><span class="comment"># unit: second</span></span><br><span class="line"><span class="comment"># default value is 3600</span></span><br><span class="line"><span class="comment"># since V4.05</span></span><br><span class="line"><span class="attr">connection_pool_max_idle_time</span> = <span class="number">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if load FastDFS parameters from tracker server</span></span><br><span class="line"><span class="comment"># since V4.05</span></span><br><span class="line"><span class="comment"># default value is false</span></span><br><span class="line"><span class="attr">load_fdfs_parameters_from_tracker</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if use storage ID instead of IP address</span></span><br><span class="line"><span class="comment"># same as tracker.conf</span></span><br><span class="line"><span class="comment"># valid only when load_fdfs_parameters_from_tracker is false</span></span><br><span class="line"><span class="comment"># default value is false</span></span><br><span class="line"><span class="comment"># since V4.05</span></span><br><span class="line"><span class="attr">use_storage_id</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># specify storage ids filename, can use relative or absolute path</span></span><br><span class="line"><span class="comment"># same as tracker.conf</span></span><br><span class="line"><span class="comment"># valid only when load_fdfs_parameters_from_tracker is false</span></span><br><span class="line"><span class="comment"># since V4.05</span></span><br><span class="line"><span class="attr">storage_ids_filename</span> = storage_ids.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#HTTP settings</span></span><br><span class="line"><span class="attr">http.tracker_server_port</span>=<span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#use &quot;#include&quot; directive to include HTTP other settiongs</span></span><br><span class="line"><span class="comment">##include http.conf</span></span><br></pre></td></tr></table></figure><p>其中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base_path&#x3D;FastDFS客户端存放日志文件的目录</span><br><span class="line">tracker_server&#x3D;运行Tracker服务的机器ip:22122</span><br></pre></td></tr></table></figure><h5 id="FastDFS客户端实现文件存储"><a href="#FastDFS客户端实现文件存储" class="headerlink" title="FastDFS客户端实现文件存储"></a>FastDFS客户端实现文件存储</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 shell 进入 Python交互环境</span></span><br><span class="line">(python3_mall) Tony-iMac:FastDFS_ElasticSearch tony$ python manage.py shell</span><br><span class="line">[&#x27;/Users/tony/PycharmProjects/FastDFS_ElasticSearch&#x27;, &#x27;/usr/local/opt/python@3.8/Frameworks/Python.framework/Versions/3.8/lib/python38.zip&#x27;, &#x27;/usr/local/opt/python@3.8/Frameworks/Python.framework/Versions/3.8/lib/python3.8&#x27;, &#x27;/usr/local/opt/python@3.8/Frameworks/Python.framework/Versions/3.8/lib/python3.8/lib-dynload&#x27;, &#x27;/Users/tony/.virtualenvs/python3_mall/lib/python3.8/site-packages&#x27;]</span><br><span class="line">Python 3.8.5 (default, Jul 21 2020, 10:41:41) </span><br><span class="line">[Clang 10.0.0 (clang-1000.11.45.5)] on darwin</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">(InteractiveConsole)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. 导入FastDFS客户端扩展</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; from fdfs_client.client import Fdfs_client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 创建FastDFS客户端实例</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; client = Fdfs_client(<span class="string">&#x27;utils/fastdfs_client.conf&#x27;</span>)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 调用FastDFS客户端上传文件方法</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ret = client.upload_by_filename(<span class="string">&#x27;/Users/tony/Desktop/as_00004.jpg&#x27;</span>)</span></span><br><span class="line">getting connection</span><br><span class="line">&lt;fdfs_client.connection.Connection object at 0x1108079d0&gt;</span><br><span class="line">&lt;fdfs_client.fdfs_protol.Tracker_header object at 0x1108079a0&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 上传文件返回的结果</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ret</span></span><br><span class="line">&#123;&#x27;Group name&#x27;: &#x27;group1&#x27;, &#x27;Remote file_id&#x27;: &#x27;group1/M00/00/02/rBCygV_4HXSAFMm1AADPoAE1Ydk823.jpg&#x27;, &#x27;Status&#x27;: &#x27;Upload successed.&#x27;, &#x27;Local file name&#x27;: &#x27;/Users/tony/Desktop/as_00004.jpg&#x27;, &#x27;Uploaded size&#x27;: &#x27;51.00KB&#x27;, &#x27;Storage IP&#x27;: &#x27;172.16.178.129&#x27;&#125;</span><br></pre></td></tr></table></figure><p>分析下返回参数的含义和宿主机上上传成功的文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ret = &#123;</span><br><span class="line"><span class="string">&#x27;Group name&#x27;</span>: <span class="string">&#x27;Storage组名&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Remote file_id&#x27;</span>: <span class="string">&#x27;文件索引，可用于下载&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Status&#x27;</span>: <span class="string">&#x27;文件上传结果反馈&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Local file name&#x27;</span>: <span class="string">&#x27;本地上传文件全路径&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Uploaded size&#x27;</span>: <span class="string">&#x27;文件大小&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Storage IP&#x27;</span>: <span class="string">&#x27;Storage地址&#x27;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108165804.png"></p><h4 id="下载渲染文件"><a href="#下载渲染文件" class="headerlink" title="下载渲染文件"></a>下载渲染文件</h4><ul><li>协议:<code>http</code></li><li>IP地址:<code>172.16.178.129</code><ul><li><code>Nginx</code>服务器的IP地址（FastDFS服务器ip地址，即宿主机Ubuntu的ip）。</li><li>因为 FastDFS 擅长存储静态文件，但是不擅长提供静态文件的下载服务，所以我们一般会将 Nginx 服务器绑定到 Storage ，提升下载性能。</li></ul></li><li>端口:<code>8888</code><ul><li><code>Nginx</code>服务器的端口。</li></ul></li><li>路径:<code>group1/M00/00/02/rBCygV_4HXSAFMm1AADPoAE1Ydk823.jpg</code><ul><li>文件在Storage上的文件索引。</li></ul></li><li>完整图片下载地址:<code>http://172.16.178.129:8888/group1/M00/00/02/rBCygV_4HXSAFMm1AADPoAE1Ydk823.jpg</code></li></ul><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108165958.png"></p><h4 id="对接Django"><a href="#对接Django" class="headerlink" title="对接Django"></a>对接Django</h4><p>经过以上操作，其实我们还没把FastDFS用于Django中，我们只是知道了怎么使用FastDFS。对于返回的图片地址，在django中你会如何处理呢？如果将图片地址直接保存在数据库，相对地址肯定访问不了，每次渲染前加上FastDFS服务器ip？其实Django帮我们准备了自定义文件存储类，我们自定义一下即可。</p><p>我这里提前在数据库准备了一些数据，图片路径就是用的FastDFS服务器中存的图片路径。访问下看下；</p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108173055.png"></p><p>可以看出来图片都没有显示出来，我们看下源码可以看到图片路径都是相对的，所以访问不到</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>Apple MacBook Pro 13.3英寸笔记本 银色<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>Apple MacBook Pro 13.3英寸笔记本 银色<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;group1/M00/00/02/CtM3BVrPB4GAWkTlAAGuN6wB9fU4220429&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Apple MacBook Pro 13.3英寸笔记本 银色&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="自定义Django文件存储类"><a href="#自定义Django文件存储类" class="headerlink" title="自定义Django文件存储类"></a>自定义Django文件存储类</h5><p>不懂得可以参考<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL2VuLzEuMTEvaG93dG8vY3VzdG9tLWZpbGUtc3RvcmFnZS8=">自定义文件存储类的官方文档<i class="fa fa-external-link-alt"></i></span>，自定义存储类位置：<code>FastDFS_ElasticSearch/utils/fastdfs_storage.py/FastDFSStorage</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2021/1/6 14:35</span></span><br><span class="line"><span class="comment"># @Author  : 托小尼</span></span><br><span class="line"><span class="comment"># @Email   : 646547989@qq.com</span></span><br><span class="line"><span class="comment"># @URI     : https://www.diandian100.cn</span></span><br><span class="line"><span class="comment"># @File    : fastdfs_storage.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.core.files.storage <span class="keyword">import</span> Storage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastDFSStorage</span>(<span class="params">Storage</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;自定义文件存储类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, fdfs_base_url=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        构造方法，可以不带参数，也可以携带参数</span></span><br><span class="line"><span class="string">        :param base_url: Storage的IP</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.fdfs_base_url = fdfs_base_url <span class="keyword">or</span> settings.FDFS_BASE_URL</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_open</span>(<span class="params">self, name, mode=<span class="string">&#x27;rb&#x27;</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        用于打开文件</span></span><br><span class="line"><span class="string">        :param name: 要打开的文件的名字</span></span><br><span class="line"><span class="string">        :param mode: 打开文件方式</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 打开文件时使用的，此时不需要，而文档告诉说明必须实现，所以pass</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_save</span>(<span class="params">self, name, content</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        用于保存文件</span></span><br><span class="line"><span class="string">        :param name: 要保存的文件名字</span></span><br><span class="line"><span class="string">        :param content: 要保存的文件的内容</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 保存文件时使用的，此时不需要，而文档告诉说明必须实现，所以pass</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">url</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        返回name所指文件的绝对URL</span></span><br><span class="line"><span class="string">        :param name: 要读取文件的引用:group1/M00/00/02/rBCygV_4HXSAFMm1AADPoAE1Ydk823.jpg</span></span><br><span class="line"><span class="string">        :return: http://172.16.178.129:8888/group1/M00/00/02/rBCygV_4HXSAFMm1AADPoAE1Ydk823.jpg</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># return &#x27;http://172.16.178.129:8888/&#x27; + name</span></span><br><span class="line">        <span class="keyword">return</span> self.fdfs_base_url + name</span><br></pre></td></tr></table></figure><h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定自定义的Django文件存储类</span></span><br><span class="line">DEFAULT_FILE_STORAGE = <span class="string">&#x27;utils.fastdfs_storage.FastDFSStorage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FastDFS相关参数</span></span><br><span class="line">FDFS_BASE_URL = <span class="string">&#x27;http://172.16.178.129:8888/&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="修改模板图片地址调用"><a href="#修改模板图片地址调用" class="headerlink" title="修改模板图片地址调用"></a>修改模板图片地址调用</h5><p>将原来的<code>&#123;&#123; good.img &#125;&#125;</code>修改为<code>&#123;&#123; good.img.url &#125;&#125;</code></p><p><img data-src="https://20200324picgo-1251846158.cos.ap-shanghai.myqcloud.com/20210108174157.png"></p><p>渲染后的html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span>Apple MacBook Pro 13.3英寸笔记本 银色<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span>Apple MacBook Pro 13.3英寸笔记本 银色<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://172.16.178.129:8888/group1/M00/00/02/CtM3BVrPB4GAWkTlAAGuN6wB9fU4220429&quot;</span> <span class="attr">height</span>=<span class="string">&quot;30&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Apple MacBook Pro 13.3英寸笔记本 银色&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>到此我们完成了在django中使用FastDFS，另外有的小伙伴说了，这样每次都写个ip感觉很不友好，能不能换成ip，当然能，这个就跟平时我们做网站一样，改下host就行了</p><blockquote><ul><li>在<code>/etc/hosts</code>中添加访问Storage的域名</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ Storage的IP        域名</span><br><span class="line">$ 172.16.178.129    image.diandian100.cn</span><br></pre></td></tr></table></figure><p>最后我还要说的是，为什么前面FastDFS已经可以独立的上传下载渲染了，可以跟Django没有任何关系，哪儿都能用了，为什么最后还要说django渲染图片的，貌似也跟FastDfs关系不大了，其实我主要是为了后面在这个项目中使用ElasticSearch而做的准备，下一篇文章我将在这个项目中融入ElasticSearch，不会的小伙伴收藏下吧。</p><blockquote><p>文章参考来源：</p><p><span class="exturl" data-url="aHR0cDovL3d3dy5pdHlvdWtub3cuY29tL2Zhc3RkZnMvMjAxOC8wMS8wNi9kaXN0cmlidXRlZC1maWxlLXN5c3RlbS1mYXN0ZGZzLmh0bWw=">分布式文件系统FastDFS详解<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhcHB5ZmlzaDEwMC8=">官方网站<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhcHB5ZmlzaDEwMC9mYXN0ZGZzL3dpa2kv">配置文档<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhcHB5ZmlzaDEwMC9mYXN0ZGZzLWNsaWVudC1qYXZh">Java客户端<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cDovL2Jsb2cuY2hpbmF1bml4Lm5ldC91aWQtMjAxOTYzMTgtaWQtNDA1ODU2MS5odG1s">分布式文件系统FastDFS设计原理<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8xYzcxYWUwMjRlNWU=">FASTDFS<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cDovL3d3dy5pdHlvdWtub3cuY29tL2Zhc3RkZnMvMjAxNy8xMC8xMC9jbHVzdGVyLWJ1aWxkaW5nLWZhc3RkZnMuaHRtbA==">FastDFS 集群 安装 配置 <i class="fa fa-external-link-alt"></i></span></p></blockquote></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/d76507f7.html" rel="bookmark">python 网络编程二(软件开发的架构)</a></div></li></ul><footer class="post-footer"><div class="reward-container"><div>打赏个鸡腿</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="托小尼 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="托小尼 支付宝"> <span>支付宝</span></div></div></div><div class="post-tags"><a href="/tags/client/" rel="tag"><i class="fa fa-tag"></i> client</a> <a href="/tags/FastDFS/" rel="tag"><i class="fa fa-tag"></i> FastDFS</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> 分布式文件系统</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> 文件存储系统</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA/" rel="tag"><i class="fa fa-tag"></i> 文件存储系统搭建</a> <a href="/tags/fastdfs%E9%85%8D%E7%BD%AE/" rel="tag"><i class="fa fa-tag"></i> fastdfs配置</a> <a href="/tags/fastdfs%E4%BD%BF%E7%94%A8/" rel="tag"><i class="fa fa-tag"></i> fastdfs使用</a> <a href="/tags/django%E4%BD%BF%E7%94%A8fastdfs/" rel="tag"><i class="fa fa-tag"></i> django使用fastdfs</a> <a href="/tags/elasticsearch/" rel="tag"><i class="fa fa-tag"></i> elasticsearch</a> <a href="/tags/django%E4%BD%BF%E7%94%A8elasticsearch/" rel="tag"><i class="fa fa-tag"></i> django使用elasticsearch</a> <a href="/tags/tracker/" rel="tag"><i class="fa fa-tag"></i> tracker</a> <a href="/tags/storage/" rel="tag"><i class="fa fa-tag"></i> storage</a> <a href="/tags/%E8%B7%9F%E8%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 跟踪服务器</a> <a href="/tags/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 存储服务器</a></div><div class="post-nav"><div class="post-nav-item"><a href="/8554d002.html" rel="prev" title="Warning require open_basedir restriction in effect"><i class="fa fa-chevron-left"></i> Warning require open_basedir restriction in effect</a></div><div class="post-nav-item"><a href="/21a33370.html" rel="next" title="如何在Django中使用ElasticSearch">如何在Django中使用ElasticSearch <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments"><div id="SOHUCS"></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">豫ICP备17028303号-1 </span><img src="http://www.beian.gov.cn/portal/download" style="display:inline-block"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5nb3YuY24vcG9ydGFsL3JlZ2lzdGVyU3lzdGVtSW5mbz9yZWNvcmRjb2RlPTE3MDI4MzAz">豫公网安备 41102402000095号</span></div><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Tony Yu</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">1.3m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">19:23</span></span></div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1.15.0/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments('#SOHUCS', () => {
    NexT.utils.getScript('https://changyan.sohu.com/upload/changyan.js', () => {
      window.changyan.api.config({
        appid: 'cyu11Umgd',
        conf : '0f296687f6a61e82028fd7c6ddf32ab9'
      });
    });
  });</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script></body></html>